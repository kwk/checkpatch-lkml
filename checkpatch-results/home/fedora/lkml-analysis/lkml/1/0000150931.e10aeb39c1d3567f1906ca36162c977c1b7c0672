WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#36: FILE: drivers/block/drbd/drbd_req.h:1:
+/*

The source file is missing or has an improper SPDX identifier tag.
The Linux kernel requires the precise SPDX identifier in all source files,
and it is thoroughly documented in the kernel docs.

See: https://www.kernel.org/doc/html/latest/process/license-rules.html

WARNING:BLOCK_COMMENT_STYLE: Block comments use * on subsequent lines
#37: FILE: drivers/block/drbd/drbd_req.h:2:
+/*
+   drbd_req.h

The comment style is incorrect.  The preferred style for multi-
line comments is::

  /*
  * This is the preferred style
  * for multi line comments.
  */

The networking comment style is a bit different, with the first line
not empty like the former::

  /* This is the preferred comment style
  * for files in net/ and drivers/net/
  */

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#commenting

ERROR:FSF_MAILING_ADDRESS: Do not include the paragraph about writing to the Free Software Foundation's mailing address from the sample GPL notice. The FSF has changed addresses in the past, and may do so again. Linux already includes a copy of the GPL.
#58: FILE: drivers/block/drbd/drbd_req.h:23:
+   the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.$

Kernel maintainers reject new instances of the GPL boilerplate paragraph
directing people to write to the FSF for a copy of the GPL, since the
FSF has moved in the past and may do so again.
So do not write paragraphs about writing to the Free Software Foundation's
mailing address.

See: https://lore.kernel.org/lkml/20131006222342.GT19510@leaf/

WARNING:BLOCK_COMMENT_STYLE: Block comments use * on subsequent lines
#73: FILE: drivers/block/drbd/drbd_req.h:38:
+/* The request callbacks will be called in irq context by the IDE drivers,
+   and in Softirqs/Tasklets/BH context by the SCSI drivers,

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#75: FILE: drivers/block/drbd/drbd_req.h:40:
+   Try to get the locking right :) */

WARNING:TYPO_SPELLING: 'sucessfully' may be misspelled - perhaps 'successfully'?
#97: FILE: drivers/block/drbd/drbd_req.h:62:
+ *    either sucessfully or with io-error.
              ^^^^^^^^^^^

Some words may have been misspelled.  Consider reviewing them.

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#126: FILE: drivers/block/drbd/drbd_req.h:91:
+	 * oh, well... */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#190: FILE: drivers/block/drbd/drbd_req.h:155:
+	 * until the corresponding barrier ack comes in */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#197: FILE: drivers/block/drbd/drbd_req.h:162:
+	 * no longer occur. */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#206: FILE: drivers/block/drbd/drbd_req.h:171:
+	 * from a request without, regardless of what happens to it. */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#210: FILE: drivers/block/drbd/drbd_req.h:175:
+	 * basically this means the corresponding BarrierAck was received */

CHECK:BIT_MACRO: Prefer using the BIT macro
#225: FILE: drivers/block/drbd/drbd_req.h:190:
+#define RQ_LOCAL_PENDING   (1UL << __RQ_LOCAL_PENDING)

Defines like: 1 << <digit> could be BIT(digit).
The BIT() macro is defined via include/linux/bits.h::

  #define BIT(nr)         (1UL << (nr))

CHECK:BIT_MACRO: Prefer using the BIT macro
#226: FILE: drivers/block/drbd/drbd_req.h:191:
+#define RQ_LOCAL_COMPLETED (1UL << __RQ_LOCAL_COMPLETED)

CHECK:BIT_MACRO: Prefer using the BIT macro
#227: FILE: drivers/block/drbd/drbd_req.h:192:
+#define RQ_LOCAL_OK        (1UL << __RQ_LOCAL_OK)

CHECK:SPACING: spaces preferred around that '-' (ctx:VxV)
#229: FILE: drivers/block/drbd/drbd_req.h:194:
+#define RQ_LOCAL_MASK      ((RQ_LOCAL_OK << 1)-1) /* 0x07 */
                                               ^

Whitespace style used in the kernel sources is described in kernel docs.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

CHECK:BIT_MACRO: Prefer using the BIT macro
#231: FILE: drivers/block/drbd/drbd_req.h:196:
+#define RQ_NET_PENDING     (1UL << __RQ_NET_PENDING)

CHECK:BIT_MACRO: Prefer using the BIT macro
#232: FILE: drivers/block/drbd/drbd_req.h:197:
+#define RQ_NET_QUEUED      (1UL << __RQ_NET_QUEUED)

CHECK:BIT_MACRO: Prefer using the BIT macro
#233: FILE: drivers/block/drbd/drbd_req.h:198:
+#define RQ_NET_SENT        (1UL << __RQ_NET_SENT)

CHECK:BIT_MACRO: Prefer using the BIT macro
#234: FILE: drivers/block/drbd/drbd_req.h:199:
+#define RQ_NET_DONE        (1UL << __RQ_NET_DONE)

CHECK:BIT_MACRO: Prefer using the BIT macro
#235: FILE: drivers/block/drbd/drbd_req.h:200:
+#define RQ_NET_OK          (1UL << __RQ_NET_OK)

CHECK:BIT_MACRO: Prefer using the BIT macro
#236: FILE: drivers/block/drbd/drbd_req.h:201:
+#define RQ_NET_SIS         (1UL << __RQ_NET_SIS)

CHECK:SPACING: spaces preferred around that '-' (ctx:VxV)
#239: FILE: drivers/block/drbd/drbd_req.h:204:
+#define RQ_NET_MASK        (((1UL << __RQ_NET_MAX)-1) & ~RQ_LOCAL_MASK)
                                                   ^

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#245: FILE: drivers/block/drbd/drbd_req.h:210:
+	BUG_ON(mdev->ee_hash_s == 0);

BUG() or BUG_ON() should be avoided totally.
Use WARN() and WARN_ON() instead, and handle the "impossible"
error condition as gracefully as possible.

See: https://www.kernel.org/doc/html/latest/process/deprecated.html#bug-and-bug-on

CHECK:SPACING: spaces preferred around that '>>' (ctx:VxV)
#247: FILE: drivers/block/drbd/drbd_req.h:212:
+		((unsigned int)(sector>>HT_SHIFT) % mdev->ee_hash_s);
 		                      ^

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#254: FILE: drivers/block/drbd/drbd_req.h:219:
+	BUG_ON(mdev->tl_hash_s == 0);

CHECK:SPACING: spaces preferred around that '>>' (ctx:VxV)
#256: FILE: drivers/block/drbd/drbd_req.h:221:
+		((unsigned int)(sector>>HT_SHIFT) % mdev->tl_hash_s);
 		                      ^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#260: FILE: drivers/block/drbd/drbd_req.h:225:
+ * verify that we actually know about it */

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#262: FILE: drivers/block/drbd/drbd_req.h:227:
+static inline struct drbd_request *_ack_id_to_req(struct drbd_conf *mdev,
+	u64 id, sector_t sector)

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#268: FILE: drivers/block/drbd/drbd_req.h:233:
+	hlist_for_each_entry(req, n, slot, colision) {
 	                                   ^^^^^^^^

WARNING:SPLIT_STRING: quoted string split across lines
#272: FILE: drivers/block/drbd/drbd_req.h:237:
+				ERR("_ack_id_to_req: found req %p but it has "
+				    "wrong sector (%llus versus %llus)\n", req,

Quoted strings that appear as messages in userspace and can be
grepped, should not be split across multiple lines.

See: https://lore.kernel.org/lkml/20120203052727.GA15035@leaf/

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#281: FILE: drivers/block/drbd/drbd_req.h:246:
+	ERR("_ack_id_to_req: failed to find req %p, sector %llus in list\n",
+		(void *)(unsigned long)id, (unsigned long long)sector);

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#293: FILE: drivers/block/drbd/drbd_req.h:258:
+ * verify that we actually know about it */

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#295: FILE: drivers/block/drbd/drbd_req.h:260:
+static inline struct drbd_request *_ar_id_to_req(struct drbd_conf *mdev,
+	u64 id, sector_t sector)

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#301: FILE: drivers/block/drbd/drbd_req.h:266:
+	hlist_for_each_entry(req, n, slot, colision) {
 	                                   ^^^^^^^^

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#311: FILE: drivers/block/drbd/drbd_req.h:276:
+static inline struct drbd_request *drbd_req_new(struct drbd_conf *mdev,
+	struct bio *bio_src)

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#327: FILE: drivers/block/drbd/drbd_req.h:292:
+		INIT_HLIST_NODE(&req->colision);
 		                      ^^^^^^^^

CHECK:SPACING: spaces preferred around that '>>' (ctx:VxV)
#345: FILE: drivers/block/drbd/drbd_req.h:310:
+	return !((s1 + (l1>>9) <= s2) || (s1 >= s2 + (l2>>9)));
 	                  ^

CHECK:SPACING: spaces preferred around that '>>' (ctx:VxV)
#345: FILE: drivers/block/drbd/drbd_req.h:310:
+	return !((s1 + (l1>>9) <= s2) || (s1 >= s2 + (l2>>9)));
 	                                                ^

WARNING:TYPO_SPELLING: 'aparently' may be misspelled - perhaps 'apparently'?
#348: FILE: drivers/block/drbd/drbd_req.h:313:
+/* aparently too large to be inlined...
    ^^^^^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#349: FILE: drivers/block/drbd/drbd_req.h:314:
+ * moved to drbd_req.c */

CHECK:AVOID_EXTERNS: extern prototypes should be avoided in .h files
#350: FILE: drivers/block/drbd/drbd_req.h:315:
+extern void _req_may_be_done(struct drbd_request *req, int error);

Function prototypes don't need to be declared extern in .h
files.  It's assumed by the compiler and is unnecessary.

CHECK:AVOID_EXTERNS: extern prototypes should be avoided in .h files
#351: FILE: drivers/block/drbd/drbd_req.h:316:
+extern void _req_mod(struct drbd_request *req,

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#352: FILE: drivers/block/drbd/drbd_req.h:317:
+extern void _req_mod(struct drbd_request *req,
+		enum drbd_req_event what, int error);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#356: FILE: drivers/block/drbd/drbd_req.h:321:
+static inline void req_mod(struct drbd_request *req,
+		enum drbd_req_event what, int error)

WARNING:LINE_SPACING: Missing a blank line after declarations
#359: FILE: drivers/block/drbd/drbd_req.h:324:
+	struct drbd_conf *mdev = req->mdev;
+	spin_lock_irq(&mdev->req_lock);

Vertical space is wasted given the limited number of lines an
editor window can display when multiple blank lines are used.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#368: FILE: drivers/block/drbd/drbd_req.c:1:
+/*

WARNING:BLOCK_COMMENT_STYLE: Block comments use * on subsequent lines
#369: FILE: drivers/block/drbd/drbd_req.c:2:
+/*
+-*- linux-c -*-

ERROR:FSF_MAILING_ADDRESS: Do not include the paragraph about writing to the Free Software Foundation's mailing address from the sample GPL notice. The FSF has changed addresses in the past, and may do so again. Linux already includes a copy of the GPL.
#391: FILE: drivers/block/drbd/drbd_req.c:24:
+   the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.$

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#404: FILE: drivers/block/drbd/drbd_req.c:37:
+ * because of the _print_rq_state(,FIXME) in barrier_acked */

CHECK:COMPARISON_TO_NULL: Comparison to NULL could be written "!req->master_bio"
#409: FILE: drivers/block/drbd/drbd_req.c:42:
+	const int rw = (req->master_bio == NULL ||

Comparisons to NULL in the form (foo == NULL) or (foo != NULL)
are better written as (!foo) and (foo).

CHECK:COMPARISON_TO_NULL: Comparison to NULL could be written "!req->master_bio"
#434: FILE: drivers/block/drbd/drbd_req.c:67:
+	const int rw = (req->master_bio == NULL ||

WARNING:STATIC_CONST_CHAR_ARRAY: static const char * array should probably be static const char * const
#438: FILE: drivers/block/drbd/drbd_req.c:71:
+	static const char *rq_event_names[] = {

CHECK:CAMELCASE: Avoid CamelCase: <TraceTypeRq>
#465: FILE: drivers/block/drbd/drbd_req.c:98:
+	MTRACE(TraceTypeRq, TraceLvlMetrics, _print_rq_state(R, T);)

Avoid CamelCase Identifiers.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#naming

CHECK:CAMELCASE: Avoid CamelCase: <TraceLvlMetrics>
#465: FILE: drivers/block/drbd/drbd_req.c:98:
+	MTRACE(TraceTypeRq, TraceLvlMetrics, _print_rq_state(R, T);)

WARNING:REPEATED_WORD: Possible repeated word: 'commit'
#479: FILE: drivers/block/drbd/drbd_req.c:112:
+ * see also commit commit a362357b6cd62643d4dda3b152639303d78473da

WARNING:TYPO_SPELLING: 'seperate' may be misspelled - perhaps 'separate'?
#482: FILE: drivers/block/drbd/drbd_req.c:115:
+ *     [BLOCK] Unify the seperate read/write io stat fields into arrays */
                          ^^^^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#482: FILE: drivers/block/drbd/drbd_req.c:115:
+ *     [BLOCK] Unify the seperate read/write io stat fields into arrays */

WARNING:LINUX_VERSION_CODE: LINUX_VERSION_CODE should be avoided, code should be for the version to which it is merged
#483: FILE: drivers/block/drbd/drbd_req.c:116:
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,16)

ERROR:SPACING: space required after that ',' (ctx:VxV)
#483: FILE: drivers/block/drbd/drbd_req.c:116:
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,16)
                                          ^

ERROR:SPACING: space required after that ',' (ctx:VxV)
#483: FILE: drivers/block/drbd/drbd_req.c:116:
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,16)
                                            ^

WARNING:CONSTANT_COMPARISON: Comparisons should place the constant on the right side of the test
#483: FILE: drivers/block/drbd/drbd_req.c:116:
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,16)

Comparisons with a constant or upper case identifier on the left
side of the test should be avoided.

WARNING:LONG_LINE: line length of 105 exceeds 100 columns
#489: FILE: drivers/block/drbd/drbd_req.c:122:
+static inline void _drbd_start_io_acct(struct drbd_conf *mdev, struct drbd_request *req, struct bio *bio)

The line has exceeded the specified maximum length.
To use a different maximum line length, the --max-line-length=n option
may be added while invoking checkpatch.

Earlier, the default line length was 80 columns.  Commit bdc48fa11e46
("checkpatch/coding-style: deprecate 80-column warning") increased the
limit to 100 columns.  This is not a hard limit either and it's
preferable to stay within 80 columns whenever possible.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#breaking-long-lines-and-strings

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#539: FILE: drivers/block/drbd/drbd_req.c:172:
+	 * release the reference to the activity log. */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#546: FILE: drivers/block/drbd/drbd_req.c:179:
+		 * here unconditionally */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#551: FILE: drivers/block/drbd/drbd_req.c:184:
+		 * READ with local io-error */

CHECK:CAMELCASE: Avoid CamelCase: <Failed>
#569: FILE: drivers/block/drbd/drbd_req.c:202:
+			if (inc_local_if_state(mdev, Failed)) {

CHECK:SPACING: spaces preferred around that '*' (ctx:VxV)
#572: FILE: drivers/block/drbd/drbd_req.c:205:
+			} else if (DRBD_ratelimit(5*HZ, 3)) {
 			                           ^

WARNING:SPLIT_STRING: quoted string split across lines
#574: FILE: drivers/block/drbd/drbd_req.c:207:
+				drbd_WARN("Should have called drbd_al_complete_io(, %llu), "
+				     "but my Disk seems to have failed :(\n",

CHECK:SPACING: No space is necessary after a cast
#575: FILE: drivers/block/drbd/drbd_req.c:208:
+				     (unsigned long long) req->sector);

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#584: FILE: drivers/block/drbd/drbd_req.c:217:
+	 * struct, reuse the request. */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#589: FILE: drivers/block/drbd/drbd_req.c:222:
+	 * until the next barrier ack? */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#596: FILE: drivers/block/drbd/drbd_req.c:229:
+			 * probably corrupt the worker list here */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#616: FILE: drivers/block/drbd/drbd_req.c:249:
+	 * and no new epoch has been created yet. */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#625: FILE: drivers/block/drbd/drbd_req.c:258:
+	 * or (on connection loss) in tl_clear.  */

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#632: FILE: drivers/block/drbd/drbd_req.c:265:
+static void _about_to_complete_local_write(struct drbd_conf *mdev,
+	struct drbd_request *req)

CHECK:CAMELCASE: Avoid CamelCase: <Tl_epoch_entry>
#636: FILE: drivers/block/drbd/drbd_req.c:269:
+	struct Tl_epoch_entry *e;

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#641: FILE: drivers/block/drbd/drbd_req.c:274:
+	 * we may need to close the current epoch */

CHECK:CAMELCASE: Avoid CamelCase: <Connected>
#642: FILE: drivers/block/drbd/drbd_req.c:275:
+	if (mdev->state.conn >= Connected &&

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#648: FILE: drivers/block/drbd/drbd_req.c:281:
+	 * this has been on the network */

CHECK:COMPARISON_TO_NULL: Comparison to NULL could be written "mdev->ee_hash"
#649: FILE: drivers/block/drbd/drbd_req.c:282:
+	if ((s & RQ_NET_DONE) && mdev->ee_hash != NULL) {

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#655: FILE: drivers/block/drbd/drbd_req.c:288:
+		 * they must have been failed on the spot */

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#658: FILE: drivers/block/drbd/drbd_req.c:291:
+		hlist_for_each_entry(i, n, slot, colision) {
 		                                 ^^^^^^^^

WARNING:TYPO_SPELLING: 'asender' may be misspelled - perhaps 'ascender'?
#672: FILE: drivers/block/drbd/drbd_req.c:305:
+		 * DiscardAck not yet sent by the asender...),
 		                                  ^^^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#678: FILE: drivers/block/drbd/drbd_req.c:311:
+		 * we just have to do a wake_up.  */

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#682: FILE: drivers/block/drbd/drbd_req.c:315:
+		hlist_for_each_entry(e, n, slot, colision) {
 		                                 ^^^^^^^^

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#693: FILE: drivers/block/drbd/drbd_req.c:326:
+static void _complete_master_bio(struct drbd_conf *mdev,
+	struct drbd_request *req, int error)

WARNING:TYPO_SPELLING: 'suceeded' may be misspelled - perhaps 'succeeded'?
#737: FILE: drivers/block/drbd/drbd_req.c:370:
+		 * report success when at least one of the operations suceeded.
 		                                                      ^^^^^^^^

WARNING:LINE_SPACING: Missing a blank line after declarations
#745: FILE: drivers/block/drbd/drbd_req.c:378:
+		int ok = (s & RQ_LOCAL_OK) || (s & RQ_NET_OK);
+		rw = bio_data_dir(req->master_bio);

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#748: FILE: drivers/block/drbd/drbd_req.c:381:
+		 * respective block_id verification hash */

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#749: FILE: drivers/block/drbd/drbd_req.c:382:
+		if (!hlist_unhashed(&req->colision))
 		                          ^^^^^^^^

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#750: FILE: drivers/block/drbd/drbd_req.c:383:
+			hlist_del(&req->colision);
 			                ^^^^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#772: FILE: drivers/block/drbd/drbd_req.c:405:
+		 * or killed from the transfer log due to connection loss. */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#776: FILE: drivers/block/drbd/drbd_req.c:409:
+	 * protocol A or B, barrier ack still pending... */

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#812: FILE: drivers/block/drbd/drbd_req.c:445:
+	D_ASSERT(hlist_unhashed(&req->colision));
 	                              ^^^^^^^^

WARNING:SPACING: space prohibited between function name and open parenthesis '('
#818: FILE: drivers/block/drbd/drbd_req.c:451:
+	ERR_IF (mdev->tl_hash_s == 0)

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#820: FILE: drivers/block/drbd/drbd_req.c:453:
+	BUG_ON(mdev->tl_hash == NULL);

CHECK:COMPARISON_TO_NULL: Comparison to NULL could be written "!mdev->tl_hash"
#820: FILE: drivers/block/drbd/drbd_req.c:453:
+	BUG_ON(mdev->tl_hash == NULL);

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#824: FILE: drivers/block/drbd/drbd_req.c:457:
+	hlist_for_each_entry(i, n, slot, colision) {
 	                                 ^^^^^^^^

WARNING:SPLIT_STRING: quoted string split across lines
#827: FILE: drivers/block/drbd/drbd_req.c:460:
+			ALERT("%s[%u] Concurrent local write detected! "
+			      "[DISCARD L] new: %llus +%u; "

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#838: FILE: drivers/block/drbd/drbd_req.c:471:
+		BUG_ON(mdev->ee_hash == NULL);

CHECK:COMPARISON_TO_NULL: Comparison to NULL could be written "!mdev->ee_hash"
#838: FILE: drivers/block/drbd/drbd_req.c:471:
+		BUG_ON(mdev->ee_hash == NULL);

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#842: FILE: drivers/block/drbd/drbd_req.c:475:
+		hlist_for_each_entry(e, n, slot, colision) {
 		                                 ^^^^^^^^

WARNING:SPLIT_STRING: quoted string split across lines
#845: FILE: drivers/block/drbd/drbd_req.c:478:
+				ALERT("%s[%u] Concurrent remote write detected!"
+				      " [DISCARD L] new: %llus +%u; "

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#858: FILE: drivers/block/drbd/drbd_req.c:491:
+	 * our users do behave after all... */

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using '_req_mod', this function's name, in a string
#887: FILE: drivers/block/drbd/drbd_req.c:520:
+		ERR("got an _req_mod() errno of %d\n", error);

Embedded function names are less appropriate to use as
refactoring can cause function renaming.  Prefer the use of
"%s", __func__ to embedded function names.

Note that this does not work with -f (--file) checkpatch option
as it depends on patch context providing the function name.

ERROR:SPACING: space prohibited before that ',' (ctx:WxW)
#893: FILE: drivers/block/drbd/drbd_req.c:526:
+		ERR("LOGIC BUG in %s:%u\n", __FILE__ , __LINE__);
 		                                     ^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#904: FILE: drivers/block/drbd/drbd_req.c:537:
+		 * and from w_read_retry_remote */

CHECK:SPACING: spaces preferred around that '>>' (ctx:VxV)
#918: FILE: drivers/block/drbd/drbd_req.c:551:
+			mdev->writ_cnt += req->size>>9;
 			                           ^

CHECK:SPACING: spaces preferred around that '>>' (ctx:VxV)
#920: FILE: drivers/block/drbd/drbd_req.c:553:
+			mdev->read_cnt += req->size>>9;
 			                           ^

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#925: FILE: drivers/block/drbd/drbd_req.c:558:
+		req->rq_state |= (RQ_LOCAL_COMPLETED|RQ_LOCAL_OK);
 		                                    ^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#976: FILE: drivers/block/drbd/drbd_req.c:609:
+		 * needs to be done from process context */

WARNING:PREFER_FALLTHROUGH: Prefer 'fallthrough;' over fallthrough comment
#978: FILE: drivers/block/drbd/drbd_req.c:611:
+		/* fall through: _req_mod(req,queue_for_net_read); */

Use the `fallthrough;` pseudo keyword instead of
`/* fallthrough */` like comments.

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#984: FILE: drivers/block/drbd/drbd_req.c:617:
+		 * or just got an io-error. */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#986: FILE: drivers/block/drbd/drbd_req.c:619:
+		 * or from bio_endio during read io-error recovery */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#989: FILE: drivers/block/drbd/drbd_req.c:622:
+		 * corresponding hlist_del is in _req_may_be_done() */

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#990: FILE: drivers/block/drbd/drbd_req.c:623:
+		hlist_add_head(&req->colision, ar_hash_slot(mdev, req->sector));
 		                     ^^^^^^^^

WARNING:TYPO_SPELLING: 'colision' may be misspelled - perhaps 'collision'?
#1006: FILE: drivers/block/drbd/drbd_req.c:639:
+		hlist_add_head(&req->colision, tl_hash_slot(mdev, req->sector));
 		                     ^^^^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1021: FILE: drivers/block/drbd/drbd_req.c:654:
+		 * Add req to the (now) current epoch (barrier). */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1024: FILE: drivers/block/drbd/drbd_req.c:657:
+		 * just after it grabs the req_lock */

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1029: FILE: drivers/block/drbd/drbd_req.c:662:
+		list_add_tail(&req->tl_requests,
+				&mdev->newest_barrier->requests);

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1050: FILE: drivers/block/drbd/drbd_req.c:683:
+		 * so it is no longer marked as on the worker queue */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1053: FILE: drivers/block/drbd/drbd_req.c:686:
+		 * this, so this should not be necessary! */

WARNING:TYPO_SPELLING: 'sucessfully' may be misspelled - perhaps 'successfully'?
#1062: FILE: drivers/block/drbd/drbd_req.c:695:
+			 * pretend it was sucessfully written on the peer. */
 			                  ^^^^^^^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1062: FILE: drivers/block/drbd/drbd_req.c:695:
+			 * pretend it was sucessfully written on the peer. */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1070: FILE: drivers/block/drbd/drbd_req.c:703:
+			 * so we know what to dirty on connection loss */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1078: FILE: drivers/block/drbd/drbd_req.c:711:
+		 * whether it is done already, and end it.  */

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#1087: FILE: drivers/block/drbd/drbd_req.c:720:
+		req->rq_state &= ~(RQ_NET_OK|RQ_NET_PENDING);
 		                            ^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1090: FILE: drivers/block/drbd/drbd_req.c:723:
+		 * it will be canceled soon. */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1100: FILE: drivers/block/drbd/drbd_req.c:733:
+		 * node crashes are covered by the activity log. */

WARNING:PREFER_FALLTHROUGH: Prefer 'fallthrough;' over fallthrough comment
#1102: FILE: drivers/block/drbd/drbd_req.c:735:
+		/* fall through */

WARNING:TYPO_SPELLING: 'unecessary' may be misspelled - perhaps 'unnecessary'?
#1112: FILE: drivers/block/drbd/drbd_req.c:745:
+		 * BarrierAck, but that is an unecessary optimisation. */
 		                              ^^^^^^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1112: FILE: drivers/block/drbd/drbd_req.c:745:
+		 * BarrierAck, but that is an unecessary optimisation. */

WARNING:TYPO_SPELLING: 'sucessfully' may be misspelled - perhaps 'successfully'?
#1116: FILE: drivers/block/drbd/drbd_req.c:749:
+		/* protocol B; pretends to be sucessfully written on peer.
 		                              ^^^^^^^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1118: FILE: drivers/block/drbd/drbd_req.c:751:
+		 * protocol != C */

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#1130: FILE: drivers/block/drbd/drbd_req.c:763:
+		req->rq_state &= ~(RQ_NET_OK|RQ_NET_PENDING);
 		                            ^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1141: FILE: drivers/block/drbd/drbd_req.c:774:
+			 * we won't be able to clean them up... */

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1143: FILE: drivers/block/drbd/drbd_req.c:776:
+			_print_rq_state(req,
+				"FIXME (barrier_acked but pending)");

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#1155: FILE: drivers/block/drbd/drbd_req.c:788:
+		req->rq_state |= (RQ_NET_OK|RQ_NET_DONE);
 		                           ^

WARNING:TYPO_SPELLING: 'UpToDate' may be misspelled - perhaps 'Up-to-date'?
#1173: FILE: drivers/block/drbd/drbd_req.c:806:
+	if (mdev->state.disk == UpToDate)
 	                        ^^^^^^^^

CHECK:CAMELCASE: Avoid CamelCase: <UpToDate>
#1173: FILE: drivers/block/drbd/drbd_req.c:806:
+	if (mdev->state.disk == UpToDate)

CHECK:CAMELCASE: Avoid CamelCase: <Outdated>
#1175: FILE: drivers/block/drbd/drbd_req.c:808:
+	if (mdev->state.disk >= Outdated)

CHECK:CAMELCASE: Avoid CamelCase: <Inconsistent>
#1177: FILE: drivers/block/drbd/drbd_req.c:810:
+	if (mdev->state.disk <  Inconsistent)

WARNING:CONSTANT_COMPARISON: Comparisons should place the constant on the right side of the test
#1189: FILE: drivers/block/drbd/drbd_req.c:822:
+	return 0 == drbd_bm_count_bits(mdev, sbnr, ebnr);

WARNING:TYPO_SPELLING: 'thats' may be misspelled - perhaps 'that's'?
#1207: FILE: drivers/block/drbd/drbd_req.c:840:
+		 * if user cannot handle io errors, thats not our business. */
 		                                    ^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1207: FILE: drivers/block/drbd/drbd_req.c:840:
+		 * if user cannot handle io errors, thats not our business. */

WARNING:TYPO_SPELLING: 'UpToDate' may be misspelled - perhaps 'Up-to-date'?
#1237: FILE: drivers/block/drbd/drbd_req.c:870:
+		remote = !local && mdev->state.pdsk >= UpToDate;
 		                                       ^^^^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1257: FILE: drivers/block/drbd/drbd_req.c:890:
+	 * of transactional on-disk meta data updates. */

WARNING:TYPO_SPELLING: 'UpToDate' may be misspelled - perhaps 'Up-to-date'?
#1261: FILE: drivers/block/drbd/drbd_req.c:894:
+	remote = remote && (mdev->state.pdsk == UpToDate ||
 	                                        ^^^^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1275: FILE: drivers/block/drbd/drbd_req.c:908:
+	 * if we lost that race, we retry.  */

CHECK:COMPARISON_TO_NULL: Comparison to NULL could be written "!mdev->unused_spare_barrier"
#1277: FILE: drivers/block/drbd/drbd_req.c:910:
+	    mdev->unused_spare_barrier == NULL &&

CHECK:ALLOC_SIZEOF_STRUCT: Prefer kmalloc(sizeof(*b)...) over kmalloc(sizeof(struct drbd_barrier)...)
#1280: FILE: drivers/block/drbd/drbd_req.c:913:
+		b = kmalloc(sizeof(struct drbd_barrier), GFP_NOIO);

The allocation style is bad.  In general for family of
allocation functions using sizeof() to get memory size,
constructs like::

  p = alloc(sizeof(struct foo), ...)

should be::

  p = alloc(sizeof(*p), ...)

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#allocating-memory

WARNING:TYPO_SPELLING: 'UpToDate' may be misspelled - perhaps 'Up-to-date'?
#1292: FILE: drivers/block/drbd/drbd_req.c:925:
+		remote = (mdev->state.pdsk == UpToDate ||
 		                              ^^^^^^^^

CHECK:COMPARISON_TO_NULL: Comparison to NULL could be written "!mdev->unused_spare_barrier"
#1304: FILE: drivers/block/drbd/drbd_req.c:937:
+	if (b && mdev->unused_spare_barrier == NULL) {

CHECK:COMPARISON_TO_NULL: Comparison to NULL could be written "!mdev->unused_spare_barrier"
#1309: FILE: drivers/block/drbd/drbd_req.c:942:
+	    mdev->unused_spare_barrier == NULL &&

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1312: FILE: drivers/block/drbd/drbd_req.c:945:
+		 * while we were grabbing the spinlock */

CHECK:LINE_SPACING: Please don't use multiple blank lines
#1317: FILE: drivers/block/drbd/drbd_req.c:950:
+
+

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1330: FILE: drivers/block/drbd/drbd_req.c:963:
+	 * barrier packet, this request is queued within the same spinlock. */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1354: FILE: drivers/block/drbd/drbd_req.c:987:
+	 * this just sets some state flags. */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1362: FILE: drivers/block/drbd/drbd_req.c:995:
+	 * THINK do we want to check reads, too? (I don't think so...) */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1389: FILE: drivers/block/drbd/drbd_req.c:1022:
+	 * we must register the request before start of local IO.  */

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1417: FILE: drivers/block/drbd/drbd_req.c:1050:
+	 * we plug after submit, so we won't miss an unplug event */

CHECK:CAMELCASE: Avoid CamelCase: <Disconnecting>
#1447: FILE: drivers/block/drbd/drbd_req.c:1080:
+	if (mdev->state.conn == Disconnecting &&

CHECK:CAMELCASE: Avoid CamelCase: <Diskless>
#1448: FILE: drivers/block/drbd/drbd_req.c:1081:
+	    mdev->state.disk == Diskless)

CHECK:CAMELCASE: Avoid CamelCase: <Primary>
#1451: FILE: drivers/block/drbd/drbd_req.c:1084:
+	if (mdev->state.role != Primary &&

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1452: FILE: drivers/block/drbd/drbd_req.c:1085:
+	if (mdev->state.role != Primary &&
+		(!allow_oos || is_write)) {

CHECK:SPACING: spaces preferred around that '*' (ctx:VxV)
#1453: FILE: drivers/block/drbd/drbd_req.c:1086:
+		if (DRBD_ratelimit(5*HZ, 5)) {
 		                    ^

WARNING:SPLIT_STRING: quoted string split across lines
#1456: FILE: drivers/block/drbd/drbd_req.c:1089:
+			    "since we are not in Primary state, "
+			    "we cannot allow this\n",

WARNING:TYPO_SPELLING: 'somehwere' may be misspelled - perhaps 'somewhere'?
#1466: FILE: drivers/block/drbd/drbd_req.c:1099:
+	 * This should have been handled (panic? suspend?) somehwere
 	                                                   ^^^^^^^^^

WARNING:TYPO_SPELLING: 'UpToDate' may be misspelled - perhaps 'Up-to-date'?
#1472: FILE: drivers/block/drbd/drbd_req.c:1105:
+	if (mdev->state.disk < UpToDate && mdev->state.pdsk < UpToDate) {
 	                       ^^^^^^^^

WARNING:TYPO_SPELLING: 'UpToDate' may be misspelled - perhaps 'Up-to-date'?
#1472: FILE: drivers/block/drbd/drbd_req.c:1105:
+	if (mdev->state.disk < UpToDate && mdev->state.pdsk < UpToDate) {
 	                                                      ^^^^^^^^

CHECK:SPACING: spaces preferred around that '*' (ctx:VxV)
#1473: FILE: drivers/block/drbd/drbd_req.c:1106:
+		if (DRBD_ratelimit(5*HZ, 5))
 		                    ^

CHECK:SPACING: No space is necessary after a cast
#1484: FILE: drivers/block/drbd/drbd_req.c:1117:
+	struct drbd_conf *mdev = (struct drbd_conf *) q->queuedata;

WARNING:LONG_LINE_COMMENT: line length of 101 exceeds 100 columns
#1500: FILE: drivers/block/drbd/drbd_req.c:1133:
+		/* drbd_WARN("Rejecting barrier request as underlying device does not support\n"); */

A comment starts before but extends beyond the maximum line length.
To use a different maximum line length, the --max-line-length=n option
may be added while invoking checkpatch.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#breaking-long-lines-and-strings

WARNING:TYPO_SPELLING: 'allignment' may be misspelled - perhaps 'alignment'?
#1512: FILE: drivers/block/drbd/drbd_req.c:1145:
+	/* to make some things easier, force allignment of requests within the
 	                                     ^^^^^^^^^^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1513: FILE: drivers/block/drbd/drbd_req.c:1146:
+	 * granularity of our hash tables */

CHECK:SPACING: spaces preferred around that '+' (ctx:VxV)
#1515: FILE: drivers/block/drbd/drbd_req.c:1148:
+	e_enr = (bio->bi_sector+(bio->bi_size>>9)-1) >> HT_SHIFT;
 	                       ^

CHECK:SPACING: spaces preferred around that '>>' (ctx:VxV)
#1515: FILE: drivers/block/drbd/drbd_req.c:1148:
+	e_enr = (bio->bi_sector+(bio->bi_size>>9)-1) >> HT_SHIFT;
 	                                     ^

CHECK:SPACING: spaces preferred around that '-' (ctx:VxV)
#1515: FILE: drivers/block/drbd/drbd_req.c:1148:
+	e_enr = (bio->bi_sector+(bio->bi_size>>9)-1) >> HT_SHIFT;
 	                                         ^

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1523: FILE: drivers/block/drbd/drbd_req.c:1156:
+	 * Maybe add our own split-arbitrary-bios function. */

WARNING:SPLIT_STRING: quoted string split across lines
#1527: FILE: drivers/block/drbd/drbd_req.c:1160:
+		ERR("bio would need to, but cannot, be split: "
+		    "(vcnt=%u,idx=%u,size=%u,sector=%llu)\n",

WARNING:LINE_SPACING: Missing a blank line after declarations
#1546: FILE: drivers/block/drbd/drbd_req.c:1179:
+		const sector_t first_sectors = sps - (sect & mask);
+		bp = bio_split(bio,

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1547: FILE: drivers/block/drbd/drbd_req.c:1180:
+		bp = bio_split(bio,
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,28)

WARNING:LINUX_VERSION_CODE: LINUX_VERSION_CODE should be avoided, code should be for the version to which it is merged
#1547: FILE: drivers/block/drbd/drbd_req.c:1180:
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,28)

ERROR:SPACING: space required after that ',' (ctx:VxV)
#1547: FILE: drivers/block/drbd/drbd_req.c:1180:
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,28)
                                          ^

ERROR:SPACING: space required after that ',' (ctx:VxV)
#1547: FILE: drivers/block/drbd/drbd_req.c:1180:
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,28)
                                            ^

WARNING:CONSTANT_COMPARISON: Comparisons should place the constant on the right side of the test
#1547: FILE: drivers/block/drbd/drbd_req.c:1180:
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,28)

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1556: FILE: drivers/block/drbd/drbd_req.c:1189:
+		 * second one! */

WARNING:TYPO_SPELLING: 'emtpy' may be misspelled - perhaps 'empty'?
#1576: FILE: drivers/block/drbd/drbd_req.c:1209:
+ * As long as the BIO is emtpy we have to allow at least one bvec,
                          ^^^^^

CHECK:SPACING: No space is necessary after a cast
#1583: FILE: drivers/block/drbd/drbd_req.c:1216:
+	struct drbd_conf *mdev = (struct drbd_conf *) q->queuedata;

CHECK:SPACING: spaces preferred around that '-' (ctx:VxV)
#1590: FILE: drivers/block/drbd/drbd_req.c:1223:
+	      - ((bio_offset & (DRBD_MAX_SEGMENT_SIZE-1)) + bio_size);
 	                                             ^

./tmp.JOzjvdpBcb//home/fedora/lkml-analysis/lkml/1/patch.offset.0000150931.commit.e10aeb39c1d3567f1906ca36162c977c1b7c0672 total: 7 errors, 117 warnings, 66 checks, 1567 lines checked

NOTE: For some of the reported defects, checkpatch may be able to
      mechanically convert to the typical style using --fix or --fix-inplace.

./tmp.JOzjvdpBcb//home/fedora/lkml-analysis/lkml/1/patch.offset.0000150931.commit.e10aeb39c1d3567f1906ca36162c977c1b7c0672 has style problems, please review.

NOTE: If any of the errors are false positives, please report
      them to the maintainer, see CHECKPATCH in MAINTAINERS.

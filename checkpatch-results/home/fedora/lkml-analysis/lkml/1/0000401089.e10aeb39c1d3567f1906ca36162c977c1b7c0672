ERROR:DIFF_IN_COMMIT_MSG: Avoid using diff content in the commit message - patch(1) might not work
#37: 
--- a/fs/Makefile	Mon Jul 09 10:53:57 2007 -0400

Avoid having diff content in commit message.
This causes problems when one tries to apply a file containing both
the changelog and the diff because patch(1) tries to apply the diff
which it found in the changelog.

See: https://lore.kernel.org/lkml/20150611134006.9df79a893e3636019ad2759e@linux-foundation.org/

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#52: FILE: fs/extent_map.c:1:
+#include <linux/bitops.h>

The source file is missing or has an improper SPDX identifier tag.
The Linux kernel requires the precise SPDX identifier in all source files,
and it is thoroughly documented in the kernel docs.

See: https://www.kernel.org/doc/html/latest/process/license-rules.html

CHECK:LINE_SPACING: Please don't use multiple blank lines
#74: FILE: fs/extent_map.c:23:
+
+

Vertical space is wasted given the limited number of lines an
editor window can display when multiple blank lines are used.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

CHECK:BIT_MACRO: Prefer using the BIT macro
#77: FILE: fs/extent_map.c:26:
+#define EXTENT_WRITEBACK (1 << 1)

Defines like: 1 << <digit> could be BIT(digit).
The BIT() macro is defined via include/linux/bits.h::

  #define BIT(nr)         (1UL << (nr))

CHECK:BIT_MACRO: Prefer using the BIT macro
#78: FILE: fs/extent_map.c:27:
+#define EXTENT_UPTODATE (1 << 2)

CHECK:BIT_MACRO: Prefer using the BIT macro
#79: FILE: fs/extent_map.c:28:
+#define EXTENT_LOCKED (1 << 3)

CHECK:BIT_MACRO: Prefer using the BIT macro
#80: FILE: fs/extent_map.c:29:
+#define EXTENT_NEW (1 << 4)

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#87: FILE: fs/extent_map.c:36:
+	extent_map_cache = kmem_cache_create("extent_map",
+					    sizeof(struct extent_map), 0,

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#92: FILE: fs/extent_map.c:41:
+	extent_state_cache = kmem_cache_create("extent_state",
+					    sizeof(struct extent_state), 0,

WARNING:LINE_SPACING: Missing a blank line after declarations
#111: FILE: fs/extent_map.c:60:
+	struct extent_map *em;
+	em = kmem_cache_alloc(extent_map_cache, mask);

WARNING:LINE_SPACING: Missing a blank line after declarations
#132: FILE: fs/extent_map.c:81:
+	struct extent_state *state;
+	state = kmem_cache_alloc(extent_state_cache, mask);

ERROR:POINTER_LOCATION: "foo ** bar" should be "foo **bar"
#155: FILE: fs/extent_map.c:104:
+	struct rb_node ** p = &root->rb_node;

When using pointer data or a function that returns a pointer type,
the preferred use of * is adjacent to the data name or function name
and not adjacent to the type name.
Examples::

  char *linux_banner;
  unsigned long long memparse(char *ptr, char **retptr);
  char *match_strdup(substring_t *s);

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

ERROR:POINTER_LOCATION: "foo * bar" should be "foo *bar"
#156: FILE: fs/extent_map.c:105:
+	struct rb_node * parent = NULL;

ERROR:SPACING: space required before the open parenthesis '('
#159: FILE: fs/extent_map.c:108:
+	while(*p) {

Whitespace style used in the kernel sources is described in kernel docs.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#179: FILE: fs/extent_map.c:128:
+static struct rb_node *__tree_search(struct rb_root *root, u64 offset,
+				   struct rb_node **prev_ret)

ERROR:POINTER_LOCATION: "foo * bar" should be "foo *bar"
#181: FILE: fs/extent_map.c:130:
+	struct rb_node * n = root->rb_node;

ERROR:SPACING: space required before the open parenthesis '('
#186: FILE: fs/extent_map.c:135:
+	while(n) {

ERROR:SPACING: space required before the open parenthesis '('
#200: FILE: fs/extent_map.c:149:
+	while(prev && offset > prev_entry->end) {

WARNING:LINE_SPACING: Missing a blank line after declarations
#212: FILE: fs/extent_map.c:161:
+	struct rb_node *ret;
+	ret = __tree_search(root, offset, &prev);

WARNING:TABSTOP: Statements should start on a tabstop
#264: FILE: fs/extent_map.c:213:
+	 }

WARNING:LINE_SPACING: Missing a blank line after declarations
#409: FILE: fs/extent_map.c:358:
+	struct rb_node *node;
+	prealloc->start = orig->start;

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#430: FILE: fs/extent_map.c:379:
+static int clear_state_bit(struct extent_map_tree *tree,
+			    struct extent_state *state, int bits, int wake,

WARNING:LINE_SPACING: Missing a blank line after declarations
#434: FILE: fs/extent_map.c:383:
+	int ret = state->state & bits;
+	state->state &= ~bits;

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#512: FILE: fs/extent_map.c:461:
+		BUG_ON(err == -EEXIST);

BUG() or BUG_ON() should be avoided totally.
Use WARN() and WARN_ON() instead, and handle the "impossible"
error condition as gracefully as possible.

See: https://www.kernel.org/doc/html/latest/process/deprecated.html#bug-and-bug-on

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#533: FILE: fs/extent_map.c:482:
+		BUG_ON(err == -EEXIST);

WARNING:LINE_SPACING: Missing a blank line after declarations
#568: FILE: fs/extent_map.c:517:
+	DEFINE_WAIT(wait);
+	prepare_to_wait(&state->wq, &wait, TASK_UNINTERRUPTIBLE);

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#664: FILE: fs/extent_map.c:613:
+		BUG_ON(err == -EEXIST);

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#715: FILE: fs/extent_map.c:664:
+		BUG_ON(err == -EEXIST);

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#742: FILE: fs/extent_map.c:691:
+		BUG_ON(err == -EEXIST);

WARNING:LINE_SPACING: Missing a blank line after declarations
#759: FILE: fs/extent_map.c:708:
+		u64 this_end = min(end, last_start);
+		err = insert_state(tree, prealloc, start, this_end,

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#762: FILE: fs/extent_map.c:711:
+		BUG_ON(err == -EEXIST);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#804: FILE: fs/extent_map.c:753:
+int set_extent_new(struct extent_map_tree *tree, u64 start, u64 end,
+		     gfp_t mask)

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#812: FILE: fs/extent_map.c:761:
+int clear_extent_new(struct extent_map_tree *tree, u64 start, u64 end,
+		       gfp_t mask)

WARNING:LINE_SPACING: Missing a blank line after declarations
#862: FILE: fs/extent_map.c:811:
+	u64 failed_start;
+	while (1) {

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#895: FILE: fs/extent_map.c:844:
+		BUG_ON(!page);

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#916: FILE: fs/extent_map.c:865:
+		BUG_ON(!page);

WARNING:LINE_SPACING: Missing a blank line after declarations
#1039: FILE: fs/extent_map.c:988:
+	u64 end = start + PAGE_CACHE_SIZE - 1;
+	if (test_range_bit(tree, start, end, EXTENT_UPTODATE, 1))

WARNING:LINE_SPACING: Missing a blank line after declarations
#1053: FILE: fs/extent_map.c:1002:
+	u64 end = start + PAGE_CACHE_SIZE - 1;
+	if (!test_range_bit(tree, start, end, EXTENT_LOCKED, 0))

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1063: FILE: fs/extent_map.c:1012:
+static int check_page_writeback(struct extent_map_tree *tree,
+			     struct page *page)

WARNING:LINE_SPACING: Missing a blank line after declarations
#1067: FILE: fs/extent_map.c:1016:
+	u64 end = start + PAGE_CACHE_SIZE - 1;
+	if (!test_range_bit(tree, start, end, EXTENT_WRITEBACK, 0))

WARNING:TYPO_SPELLING: 'uptodate' may be misspelled - perhaps 'up-to-date'?
#1076: FILE: fs/extent_map.c:1025:
+ * clear the uptodate bits on error
              ^^^^^^^^

Some words may have been misspelled.  Consider reviewing them.

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1084: FILE: fs/extent_map.c:1033:
+static int end_bio_extent_writepage(struct bio *bio,
+				   unsigned int bytes_done, int err)

WARNING:TYPO_SPELLING: 'uptodate' may be misspelled - perhaps 'up-to-date'?
#1086: FILE: fs/extent_map.c:1035:
+	const int uptodate = test_bit(BIO_UPTODATE, &bio->bi_flags);
 	          ^^^^^^^^

WARNING:LINE_SPACING: Missing a blank line after declarations
#1098: FILE: fs/extent_map.c:1047:
+		struct page *page = bvec->bv_page;
+		start = (page->index << PAGE_CACHE_SHIFT) + bvec->bv_offset;

WARNING:TYPO_SPELLING: 'uptodate' may be misspelled - perhaps 'up-to-date'?
#1109: FILE: fs/extent_map.c:1058:
+		if (!uptodate) {
 		     ^^^^^^^^

WARNING:TYPO_SPELLING: 'uptodate' may be misspelled - perhaps 'up-to-date'?
#1128: FILE: fs/extent_map.c:1077:
+ * clear the uptodate bits on error
              ^^^^^^^^

WARNING:TYPO_SPELLING: 'uptodate' may be misspelled - perhaps 'up-to-date'?
#1129: FILE: fs/extent_map.c:1078:
+ * set the uptodate bits if things worked
            ^^^^^^^^

WARNING:TYPO_SPELLING: 'uptodate' may be misspelled - perhaps 'up-to-date'?
#1130: FILE: fs/extent_map.c:1079:
+ * set the page up to date if all extents in the tree are uptodate
                                                           ^^^^^^^^

WARNING:TYPO_SPELLING: 'uptodate' may be misspelled - perhaps 'up-to-date'?
#1140: FILE: fs/extent_map.c:1089:
+	const int uptodate = test_bit(BIO_UPTODATE, &bio->bi_flags);
 	          ^^^^^^^^

WARNING:LINE_SPACING: Missing a blank line after declarations
#1152: FILE: fs/extent_map.c:1101:
+		struct page *page = bvec->bv_page;
+		start = (page->index << PAGE_CACHE_SHIFT) + bvec->bv_offset;

WARNING:TYPO_SPELLING: 'uptodate' may be misspelled - perhaps 'up-to-date'?
#1163: FILE: fs/extent_map.c:1112:
+		if (uptodate) {
 		    ^^^^^^^^

WARNING:TYPO_SPELLING: 'uptodate' may be misspelled - perhaps 'up-to-date'?
#1188: FILE: fs/extent_map.c:1137:
+ * the structs in the extent tree when done, and set the uptodate bits
                                                          ^^^^^^^^

WARNING:TYPO_SPELLING: 'uptodate' may be misspelled - perhaps 'up-to-date'?
#1194: FILE: fs/extent_map.c:1143:
+	const int uptodate = test_bit(BIO_UPTODATE, &bio->bi_flags);
 	          ^^^^^^^^

WARNING:LINE_SPACING: Missing a blank line after declarations
#1205: FILE: fs/extent_map.c:1154:
+		struct page *page = bvec->bv_page;
+		start = (page->index << PAGE_CACHE_SHIFT) + bvec->bv_offset;

WARNING:TYPO_SPELLING: 'uptodate' may be misspelled - perhaps 'up-to-date'?
#1211: FILE: fs/extent_map.c:1160:
+		if (uptodate) {
 		    ^^^^^^^^

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#1306: FILE: fs/extent_map.c:1255:
+		BUG_ON(em->end < cur);

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#1307: FILE: fs/extent_map.c:1256:
+		BUG_ON(end < cur);

WARNING:LINE_SPACING: Missing a blank line after declarations
#1348: FILE: fs/extent_map.c:1297:
+		size_t last_off = last_byte & (PAGE_CACHE_SIZE - 1);
+		zero_user_page(page, last_off, PAGE_CACHE_SIZE - last_off,

WARNING:LEADING_SPACE: please, no spaces at the start of a line
#1350: FILE: fs/extent_map.c:1299:
+       }$

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1368: FILE: fs/extent_map.c:1317:
+int extent_write_full_page(struct extent_map_tree *tree, struct page *page,
+			  get_extent_t *get_extent,

WARNING:LINE_SPACING: Missing a blank line after declarations
#1397: FILE: fs/extent_map.c:1346:
+		size_t offset = i_size & (PAGE_CACHE_SIZE - 1);
+		zero_user_page(page, offset,

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#1424: FILE: fs/extent_map.c:1373:
+		BUG_ON(em->end < cur);

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#1425: FILE: fs/extent_map.c:1374:
+		BUG_ON(end < cur);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1444: FILE: fs/extent_map.c:1393:
+		if (0 && !test_range_bit(tree, cur, cur + iosize - 1,
+				   EXTENT_DIRTY, 0)) {

WARNING:LINE_SPACING: Missing a blank line after declarations
#1477: FILE: fs/extent_map.c:1426:
+	u64 end = start + PAGE_CACHE_SIZE - 1 - offset;
+	lock_extent(tree, start, end, GFP_NOFS);

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1490: FILE: fs/extent_map.c:1439:
+			unsigned from, unsigned to)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1490: FILE: fs/extent_map.c:1439:
+			unsigned from, unsigned to)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1512: FILE: fs/extent_map.c:1461:
+			 unsigned from, unsigned to, get_extent_t *get_extent)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1512: FILE: fs/extent_map.c:1461:
+			 unsigned from, unsigned to, get_extent_t *get_extent)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1521: FILE: fs/extent_map.c:1470:
+	unsigned blocksize = 1 << inode->i_blkbits;

ERROR:SPACING: space required before the open parenthesis '('
#1540: FILE: fs/extent_map.c:1489:
+	while(block_start <= block_end) {

WARNING:BRACES: braces {} are not necessary for single statement blocks
#1543: FILE: fs/extent_map.c:1492:
+		if (IS_ERR(em) || !em) {
+			goto err;
+		}

The placement of braces is stylistically incorrect.
The preferred way is to put the opening brace last on the line,
and put the closing brace first::

  if (x is true) {
          we do y
  }

This applies for all non-functional blocks.
However, there is one special case, namely functions: they have the
opening brace at the beginning of the next line, thus::

  int function(int x)
  {
          body of function
  }

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#placing-braces-and-spaces

WARNING:LINE_SPACING: Missing a blank line after declarations
#1571: FILE: fs/extent_map.c:1520:
+			size_t iosize;
+			sector = (em->block_start + extent_offset) >> 9;

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1583: FILE: fs/extent_map.c:1532:
+			ret = submit_extent_page(READ, tree, page,
+					 sector, iosize, page_offset, em->bdev,

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#1647: FILE: include/linux/extent_map.h:1:
+#ifndef __EXTENTMAP__

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1719: FILE: include/linux/extent_map.h:73:
+int extent_write_full_page(struct extent_map_tree *tree, struct page *page,
+			  get_extent_t *get_extent,

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1723: FILE: include/linux/extent_map.h:77:
+			 unsigned from, unsigned to, get_extent_t *get_extent);

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1723: FILE: include/linux/extent_map.h:77:
+			 unsigned from, unsigned to, get_extent_t *get_extent);

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1726: FILE: include/linux/extent_map.h:80:
+			unsigned from, unsigned to);

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1726: FILE: include/linux/extent_map.h:80:
+			unsigned from, unsigned to);

WARNING:AVOID_EXTERNS: externs should be avoided in .c files
#1736: FILE: init/main.c:97:
+extern void extent_map_init(void);

Function prototypes don't need to be declared extern in .h
files.  It's assumed by the compiler and is unnecessary.

./tmp.JOzjvdpBcb//home/fedora/lkml-analysis/lkml/1/patch.offset.0000401089.commit.e10aeb39c1d3567f1906ca36162c977c1b7c0672 total: 8 errors, 56 warnings, 17 checks, 1695 lines checked

NOTE: For some of the reported defects, checkpatch may be able to
      mechanically convert to the typical style using --fix or --fix-inplace.

./tmp.JOzjvdpBcb//home/fedora/lkml-analysis/lkml/1/patch.offset.0000401089.commit.e10aeb39c1d3567f1906ca36162c977c1b7c0672 has style problems, please review.

NOTE: If any of the errors are false positives, please report
      them to the maintainer, see CHECKPATCH in MAINTAINERS.

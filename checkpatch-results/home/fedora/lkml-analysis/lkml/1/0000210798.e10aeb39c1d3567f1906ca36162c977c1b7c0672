WARNING:COMMIT_LOG_LONG_LINE: Possible unwrapped commit description (prefer a maximum 75 chars per line)
#37: 
 - add slot release function and prevent kobject leak on device registration's

CHECK:INVALID_UTF8: Invalid UTF-8, patch and commit message should be encoded in UTF-8
#53: 
> Micha³ Miros³aw <mirq-linux@rere.qmqm.pl> wrote:
       ^

CHECK:INVALID_UTF8: Invalid UTF-8, patch and commit message should be encoded in UTF-8
#107: 
Micha³ Miros³aw
     ^

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#113: FILE: cb710.h:1:
+/*

The source file is missing or has an improper SPDX identifier tag.
The Linux kernel requires the precise SPDX identifier in all source files,
and it is thoroughly documented in the kernel docs.

See: https://www.kernel.org/doc/html/latest/process/license-rules.html

WARNING:EMBEDDED_FILENAME: It's generally not useful to have the filename in the file
#114: FILE: cb710.h:2:
+ *  cb710/cb710.h

Embedding the complete filename path inside the file isn't particularly
useful as often the path is moved around and becomes incorrect.

CHECK:INVALID_UTF8: Invalid UTF-8, patch and commit message should be encoded in UTF-8
#116: FILE: cb710.h:4:
+ *  Copyright by Micha³ Miros³aw, 2008
                       ^

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#149: FILE: cb710.h:37:
+	unsigned		platform_id;

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#151: FILE: cb710.h:39:
+	unsigned		slot_mask;

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#166: FILE: cb710.h:54:
+	unsigned port, u##t value)					\

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#172: FILE: cb710.h:60:
+	unsigned port)							\

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#178: FILE: cb710.h:66:
+	unsigned port, u##t set, u##t clear)				\

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#181: FILE: cb710.h:69:
+		(ioread##t(slot->iobase + port) & ~clear)|set,		\
 		                                         ^

Whitespace style used in the kernel sources is described in kernel docs.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#190: FILE: cb710.h:78:
+void cb710_pci_update_config_reg(struct pci_dev *pdev,
+	int reg, uint32_t and, uint32_t xor);

CHECK:OPEN_ENDED_LINE: Lines should not end with a '('
#194: FILE: cb710.h:82:
+static inline struct cb710_slot *cb710_pdev_to_slot(

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#218: FILE: cb710.h:106:
+static inline void cb710_set_irq_handler(struct cb710_slot *slot,
+	cb710_irq_handler_t handler)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#227: FILE: cb710.h:115:
+void cb710_dump_regs(struct cb710_chip *chip, unsigned dump);

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#249: FILE: cb710-mmc.h:1:
+/*

WARNING:EMBEDDED_FILENAME: It's generally not useful to have the filename in the file
#250: FILE: cb710-mmc.h:2:
+ *  cb710/cb710-mmc.h

CHECK:INVALID_UTF8: Invalid UTF-8, patch and commit message should be encoded in UTF-8
#252: FILE: cb710-mmc.h:4:
+ *  Copyright by Micha³ Miros³aw, 2008
                       ^

CHECK:UNCOMMENTED_DEFINITION: spinlock_t definition without comment
#273: FILE: cb710-mmc.h:25:
+	spinlock_t irq_lock;

CHECK:UNCOMMENTED_DEFINITION: spinlock_t definition without comment
#276: FILE: cb710-mmc.h:28:
+	spinlock_t serialization_lock;

CHECK:BIT_MACRO: Prefer using the BIT macro
#342: FILE: cb710-mmc.h:94:
+#define     CB710_MMC_RSP_PRESENT		(1 << 3)

Defines like: 1 << <digit> could be BIT(digit).
The BIT() macro is defined via include/linux/bits.h::

  #define BIT(nr)         (1UL << (nr))

CHECK:BIT_MACRO: Prefer using the BIT macro
#346: FILE: cb710-mmc.h:98:
+#define     CB710_MMC_CMD_BCR			(1 << 5)

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#367: FILE: core.c:1:
+/*

WARNING:EMBEDDED_FILENAME: It's generally not useful to have the filename in the file
#368: FILE: core.c:2:
+ *  cb710/core.c

CHECK:INVALID_UTF8: Invalid UTF-8, patch and commit message should be encoded in UTF-8
#370: FILE: core.c:4:
+ *  Copyright by Micha³ Miros³aw, 2008
                       ^

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#388: FILE: core.c:22:
+void cb710_pci_update_config_reg(struct pci_dev *pdev,
+	int reg, uint32_t mask, uint32_t xor)

WARNING:HOTPLUG_SECTION: Using __devinit is unnecessary
#399: FILE: core.c:33:
+static int __devinit cb710_pci_configure(struct pci_dev *pdev)

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#406: FILE: core.c:40:
+	cb710_pci_update_config_reg(pdev, 0x48,
+		~0x000000FF, 0x0000003F);

CHECK:LOGICAL_CONTINUATIONS: Logical continuations should be on the previous line
#416: FILE: core.c:50:
+	if (pdev0->vendor == PCI_VENDOR_ID_ENE
+	    && pdev0->device == PCI_DEVICE_ID_ENE_720) {

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#418: FILE: core.c:52:
+		cb710_pci_update_config_reg(pdev0, 0x8C,
+			~0x00F00000, 0x00100000);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#420: FILE: core.c:54:
+		cb710_pci_update_config_reg(pdev0, 0xB0,
+			~0x08000000, 0x08000000);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#424: FILE: core.c:58:
+	cb710_pci_update_config_reg(pdev0, 0x8C,
+		~0x00000F00, 0x00000200);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#426: FILE: core.c:60:
+	cb710_pci_update_config_reg(pdev0, 0x90,
+		~0x00060000, 0x00040000);

WARNING:HOTPLUG_SECTION: Using __devinit is unnecessary
#465: FILE: core.c:99:
+static int __devinit cb710_register_slot(struct cb710_chip *chip,

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#466: FILE: core.c:100:
+static int __devinit cb710_register_slot(struct cb710_chip *chip,
+	unsigned slot_mask, unsigned io_offset, const char *name)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#466: FILE: core.c:100:
+	unsigned slot_mask, unsigned io_offset, const char *name)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#466: FILE: core.c:100:
+	unsigned slot_mask, unsigned io_offset, const char *name)

WARNING:LINE_SPACING: Missing a blank line after declarations
#485: FILE: core.c:119:
+		int a, b;
+		a = atomic_read(&chip->free_test);

Vertical space is wasted given the limited number of lines an
editor window can display when multiple blank lines are used.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#489: FILE: core.c:123:
+		BUG_ON(b == a);	/* XXX: is it really possible? */

BUG() or BUG_ON() should be avoided totally.
Use WARN() and WARN_ON() instead, and handle the "impossible"
error condition as gracefully as possible.

See: https://www.kernel.org/doc/html/latest/process/deprecated.html#bug-and-bug-on

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#503: FILE: core.c:137:
+static void cb710_unregister_slot(struct cb710_chip *chip,
+	unsigned slot_mask)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#503: FILE: core.c:137:
+	unsigned slot_mask)

WARNING:AVOID_BUG: Avoid crashing the kernel - try using WARN_ON & recovery code rather than BUG() or BUG_ON()
#519: FILE: core.c:153:
+	BUG_ON(b == a);	/* XXX: is it really possible? */

WARNING:HOTPLUG_SECTION: Using __devinit is unnecessary
#542: FILE: core.c:176:
+static int __devinit cb710_probe(struct pci_dev *pdev,

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#543: FILE: core.c:177:
+static int __devinit cb710_probe(struct pci_dev *pdev,
+	const struct pci_device_id *ent)

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#558: FILE: core.c:192:
+		pci_write_config_dword(pdev, 0x48, val|0x71000000);
 		                                      ^

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#574: FILE: core.c:208:
+	chip = devm_kzalloc(&pdev->dev,
+		sizeof(*chip) + n * sizeof(*chip->slot), GFP_KERNEL);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#592: FILE: core.c:226:
+	err = devm_request_irq(&pdev->dev, pdev->irq,
+		cb710_irq_handler, IRQF_SHARED, CB710_DRIVER_NAME, chip);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#606: FILE: core.c:240:
+	dev_info(&pdev->dev, "id %d, IO 0x%p, IRQ %d\n",
+		chip->platform_id, chip->iobase, pdev->irq);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#610: FILE: core.c:244:
+		err = cb710_register_slot(chip,
+			CB710_SLOT_MMC, 0x00, "cb710-mmc");

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#617: FILE: core.c:251:
+		err = cb710_register_slot(chip,
+			CB710_SLOT_MS, 0x40, "cb710-ms");

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#624: FILE: core.c:258:
+		err = cb710_register_slot(chip,
+			CB710_SLOT_SM, 0x60, "cb710-sm");

WARNING:HOTPLUG_SECTION: Using __devexit is unnecessary
#637: FILE: core.c:271:
+static void __devexit cb710_remove_one(struct pci_dev *pdev)

CHECK:INVALID_UTF8: Invalid UTF-8, patch and commit message should be encoded in UTF-8
#684: FILE: core.c:318:
+MODULE_AUTHOR("Micha³ Miros³aw <mirq-linux@rere.qmqm.pl>");
                     ^

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#692: FILE: debug.c:1:
+/*

WARNING:EMBEDDED_FILENAME: It's generally not useful to have the filename in the file
#693: FILE: debug.c:2:
+ *  cb710/debug.c

CHECK:INVALID_UTF8: Invalid UTF-8, patch and commit message should be encoded in UTF-8
#695: FILE: debug.c:4:
+ *  Copyright by Micha³ Miros³aw, 2008
                       ^

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#709: FILE: debug.c:18:
+static const u16 allow[CB710_REG_COUNT/16] = {
                                       ^

CHECK:LINE_SPACING: Please use a blank line after function/struct/union/enum declarations
#713: FILE: debug.c:22:
+};
+static const char *const prefix[ARRAY_SIZE(allow)] = {

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#718: FILE: debug.c:27:
+static inline int allow_reg_read(unsigned block, unsigned offset, unsigned bits)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#718: FILE: debug.c:27:
+static inline int allow_reg_read(unsigned block, unsigned offset, unsigned bits)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#718: FILE: debug.c:27:
+static inline int allow_reg_read(unsigned block, unsigned offset, unsigned bits)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#720: FILE: debug.c:29:
+	unsigned mask = (1 << bits/8) - 1;

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#720: FILE: debug.c:29:
+	unsigned mask = (1 << bits/8) - 1;
 	                          ^

WARNING:LINE_SPACING: Missing a blank line after declarations
#721: FILE: debug.c:30:
+	unsigned mask = (1 << bits/8) - 1;
+	offset *= bits/8;

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#721: FILE: debug.c:30:
+	offset *= bits/8;
 	              ^

CHECK:MACRO_ARG_REUSE: Macro argument reuse 't' - possible side-effects?
#725: FILE: debug.c:34:
+#define CB710_READ_REGS_TEMPLATE(t)					\
+static void cb710_read_regs_##t(void __iomem *iobase,			\
+	u##t *reg, unsigned select)					\
+{									\
+	unsigned i, j;							\
+									\
+	for (i = 0; i < ARRAY_SIZE(allow); ++i, reg += 16/(t/8)) {	\
+		if (!select & (1 << i))					\
+			continue;					\
+									\
+		for (j = 0; j < 0x10/(t/8); ++j) {			\
+			if (!allow_reg_read(i, j, t))			\
+				continue;				\
+			reg[j] = ioread##t(iobase			\
+				+ (i << 4) + (j * (t/8)));		\
+		}							\
+	}								\
+}

CHECK:MACRO_ARG_PRECEDENCE: Macro argument 't' may be better as '(t)' to avoid precedence issues
#725: FILE: debug.c:34:
+#define CB710_READ_REGS_TEMPLATE(t)					\
+static void cb710_read_regs_##t(void __iomem *iobase,			\
+	u##t *reg, unsigned select)					\
+{									\
+	unsigned i, j;							\
+									\
+	for (i = 0; i < ARRAY_SIZE(allow); ++i, reg += 16/(t/8)) {	\
+		if (!select & (1 << i))					\
+			continue;					\
+									\
+		for (j = 0; j < 0x10/(t/8); ++j) {			\
+			if (!allow_reg_read(i, j, t))			\
+				continue;				\
+			reg[j] = ioread##t(iobase			\
+				+ (i << 4) + (j * (t/8)));		\
+		}							\
+	}								\
+}

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#727: FILE: debug.c:36:
+	u##t *reg, unsigned select)					\

CHECK:SPACING: spaces preferred around that '*' (ctx:WxV)
#727: FILE: debug.c:36:
+	u##t *reg, unsigned select)					\
 	     ^

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#729: FILE: debug.c:38:
+	unsigned i, j;							\

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#731: FILE: debug.c:40:
+	for (i = 0; i < ARRAY_SIZE(allow); ++i, reg += 16/(t/8)) {	\
 	                                                 ^

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#731: FILE: debug.c:40:
+	for (i = 0; i < ARRAY_SIZE(allow); ++i, reg += 16/(t/8)) {	\
 	                                                    ^

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#735: FILE: debug.c:44:
+		for (j = 0; j < 0x10/(t/8); ++j) {			\
 		                    ^

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#735: FILE: debug.c:44:
+		for (j = 0; j < 0x10/(t/8); ++j) {			\
 		                       ^

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#739: FILE: debug.c:48:
+				+ (i << 4) + (j * (t/8)));		\
 				                    ^

CHECK:MACRO_ARG_REUSE: Macro argument reuse 't' - possible side-effects?
#749: FILE: debug.c:58:
+#define CB710_DUMP_REGS_TEMPLATE(t)					\
+static void cb710_dump_regs_##t(struct device *dev,			\
+	const u##t *reg, unsigned select)				\
+{									\
+	const char *const xp = &cb710_xes[8 - t/4];			\
+	const char *const format = cb710_regf_##t;			\
+									\
+	char msg[100], *p;						\
+	unsigned i, j;							\
+									\
+	for (i = 0; i < ARRAY_SIZE(allow); ++i, reg += 16/(t/8)) {	\
+		if (!(select & (1 << i)))				\
+			continue;					\
+		p = msg;						\
+		for (j = 0; j < 0x10/(t/8); ++j) {			\
+			*p++ = ' ';					\
+			if (j == 8/(t/8))				\
+				*p++ = ' ';				\
+			if (allow_reg_read(i, j, t))			\
+				p += sprintf(p, format, reg[j]);	\
+			else						\
+				p += sprintf(p, "%s", xp);		\
+		}							\
+		dev_dbg(dev, "%s 0x%02X %s\n", prefix[i], i << 4, msg);	\
+	}								\
+}

CHECK:MACRO_ARG_PRECEDENCE: Macro argument 't' may be better as '(t)' to avoid precedence issues
#749: FILE: debug.c:58:
+#define CB710_DUMP_REGS_TEMPLATE(t)					\
+static void cb710_dump_regs_##t(struct device *dev,			\
+	const u##t *reg, unsigned select)				\
+{									\
+	const char *const xp = &cb710_xes[8 - t/4];			\
+	const char *const format = cb710_regf_##t;			\
+									\
+	char msg[100], *p;						\
+	unsigned i, j;							\
+									\
+	for (i = 0; i < ARRAY_SIZE(allow); ++i, reg += 16/(t/8)) {	\
+		if (!(select & (1 << i)))				\
+			continue;					\
+		p = msg;						\
+		for (j = 0; j < 0x10/(t/8); ++j) {			\
+			*p++ = ' ';					\
+			if (j == 8/(t/8))				\
+				*p++ = ' ';				\
+			if (allow_reg_read(i, j, t))			\
+				p += sprintf(p, format, reg[j]);	\
+			else						\
+				p += sprintf(p, "%s", xp);		\
+		}							\
+		dev_dbg(dev, "%s 0x%02X %s\n", prefix[i], i << 4, msg);	\
+	}								\
+}

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#751: FILE: debug.c:60:
+	const u##t *reg, unsigned select)				\

CHECK:SPACING: spaces preferred around that '*' (ctx:WxV)
#751: FILE: debug.c:60:
+	const u##t *reg, unsigned select)				\
 	           ^

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#753: FILE: debug.c:62:
+	const char *const xp = &cb710_xes[8 - t/4];			\
 	                                       ^

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#757: FILE: debug.c:66:
+	unsigned i, j;							\

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#759: FILE: debug.c:68:
+	for (i = 0; i < ARRAY_SIZE(allow); ++i, reg += 16/(t/8)) {	\
 	                                                 ^

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#759: FILE: debug.c:68:
+	for (i = 0; i < ARRAY_SIZE(allow); ++i, reg += 16/(t/8)) {	\
 	                                                    ^

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#763: FILE: debug.c:72:
+		for (j = 0; j < 0x10/(t/8); ++j) {			\
 		                    ^

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#763: FILE: debug.c:72:
+		for (j = 0; j < 0x10/(t/8); ++j) {			\
 		                       ^

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#765: FILE: debug.c:74:
+			if (j == 8/(t/8))				\
 			          ^

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#765: FILE: debug.c:74:
+			if (j == 8/(t/8))				\
 			             ^

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#778: FILE: debug.c:87:
+	unsigned select)						\

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#780: FILE: debug.c:89:
+	u##t regs[CB710_REG_COUNT/sizeof(u##t)];			\
 	                         ^

ERROR:COMPLEX_MACRO: Macros with complex values should be enclosed in parentheses
#787: FILE: debug.c:96:
+#define CB710_REG_ACCESS_TEMPLATES(t)		\
+  CB710_READ_REGS_TEMPLATE(t)			\
+  CB710_DUMP_REGS_TEMPLATE(t)			\
+  CB710_READ_AND_DUMP_REGS_TEMPLATE(t)

CHECK:MACRO_ARG_REUSE: Macro argument reuse 't' - possible side-effects?
#787: FILE: debug.c:96:
+#define CB710_REG_ACCESS_TEMPLATES(t)		\
+  CB710_READ_REGS_TEMPLATE(t)			\
+  CB710_DUMP_REGS_TEMPLATE(t)			\
+  CB710_READ_AND_DUMP_REGS_TEMPLATE(t)

WARNING:LEADING_SPACE: please, no spaces at the start of a line
#788: FILE: debug.c:97:
+  CB710_READ_REGS_TEMPLATE(t)^I^I^I\$

WARNING:LEADING_SPACE: please, no spaces at the start of a line
#789: FILE: debug.c:98:
+  CB710_DUMP_REGS_TEMPLATE(t)^I^I^I\$

WARNING:LEADING_SPACE: please, no spaces at the start of a line
#790: FILE: debug.c:99:
+  CB710_READ_AND_DUMP_REGS_TEMPLATE(t)$

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#796: FILE: debug.c:105:
+void cb710_dump_regs(struct cb710_chip *chip, unsigned select)

WARNING:DEPRECATED_VARIABLE: Use of EXTRA_CFLAGS is deprecated, please use `ccflags-y instead.
#841: FILE: Makefile:26:
+EXTRA_CFLAGS	:= -DDEBUG

EXTRA_{A,C,CPP,LD}FLAGS are deprecated and should be replaced by the new
flags added via commit f77bf01425b1 ("kbuild: introduce ccflags-y,
asflags-y and ldflags-y").

The following conversion scheme maybe used::

  EXTRA_AFLAGS    ->  asflags-y
  EXTRA_CFLAGS    ->  ccflags-y
  EXTRA_CPPFLAGS  ->  cppflags-y
  EXTRA_LDFLAGS   ->  ldflags-y

See:

  1. https://lore.kernel.org/lkml/20070930191054.GA15876@uranus.ravnborg.org/
  2. https://lore.kernel.org/lkml/1313384834-24433-12-git-send-email-lacombar@gmail.com/
  3. https://www.kernel.org/doc/html/latest/kbuild/makefiles.html#compilation-flags

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#849: FILE: mmc.c:1:
+/*

WARNING:EMBEDDED_FILENAME: It's generally not useful to have the filename in the file
#850: FILE: mmc.c:2:
+ *  cb710/mmc.c

CHECK:INVALID_UTF8: Invalid UTF-8, patch and commit message should be encoded in UTF-8
#852: FILE: mmc.c:4:
+ *  Copyright by Micha³ Miros³aw, 2008
                       ^

CHECK:LINE_SPACING: Please use a blank line after function/struct/union/enum declarations
#870: FILE: mmc.c:22:
+};
+#define CB710_MAX_DIVIDER_IDX	\

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#880: FILE: mmc.c:32:
+static void verify_serialization(struct mmc_host *mmc,
+	unsigned char *counter, int inc)

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#899: FILE: mmc.c:51:
+	dev_info(cb710_slot_dev(slot),
+		"%s driver; counters now: ios=%d req=%d\n",

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#916: FILE: mmc.c:68:
+	 * MMC card with cables connected to bus signals */

The comment style is incorrect.  The preferred style for multi-
line comments is::

  /*
  * This is the preferred style
  * for multi line comments.
  */

The networking comment style is a bit different, with the first line
not empty like the former::

  /* This is the preferred comment style
  * for files in net/ and drivers/net/
  */

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#commenting

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#948: FILE: mmc.c:100:
+		cb710_write_port_8(slot, CB710_MMC_IRQ_ENABLE1_PORT,
+			CB710_MMC_IE_IRQ_ENABLE|CB710_MMC_IE_CARD_INSERTION_STATUS);

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#948: FILE: mmc.c:100:
+			CB710_MMC_IE_IRQ_ENABLE|CB710_MMC_IE_CARD_INSERTION_STATUS);
 			                       ^

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#953: FILE: mmc.c:105:
+		cb710_write_port_8(slot, CB710_MMC_IRQ_ENABLE1_PORT,
+			CB710_MMC_IE_IRQ_ENABLE|CB710_MMC_IE_CARD_INSERTION_STATUS);

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#953: FILE: mmc.c:105:
+			CB710_MMC_IE_IRQ_ENABLE|CB710_MMC_IE_CARD_INSERTION_STATUS);
 			                       ^

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#992: FILE: mmc.c:144:
+		cb710_modify_port_8(slot, CB710_MMC_CONFIG1_PORT,
+			CB710_MMC_C1_4BIT_DATA_BUS, 0);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#995: FILE: mmc.c:147:
+		cb710_modify_port_8(slot, CB710_MMC_CONFIG1_PORT,
+			0, CB710_MMC_C1_4BIT_DATA_BUS);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1009: FILE: mmc.c:161:
+		cb710_write_port_8(slot, CB710_MMC_STATUS0_PORT,
+			CB710_MMC_S0_FIFO_UNDERFLOW);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1018: FILE: mmc.c:170:
+		cb710_write_port_8(slot, CB710_MMC_STATUS1_PORT,
+			CB710_MMC_S1_RESET);

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1034: FILE: mmc.c:186:
+	unsigned limit = 2000000;	/* FIXME: real timeout */

WARNING:LINE_SPACING: Missing a blank line after declarations
#1038: FILE: mmc.c:190:
+	u32 e, x;
+	e = cb710_read_port_32(slot, CB710_MMC_STATUS_PORT);

WARNING:LINE_SPACING: Missing a blank line after declarations
#1044: FILE: mmc.c:196:
+			struct cb710_chip *chip = cb710_slot_to_chip(slot);
+			cb710_dump_regs(chip, CB710_DUMP_REGS_MMC);

CHECK:LINE_SPACING: Please don't use multiple blank lines
#1063: FILE: mmc.c:215:
+
+

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1066: FILE: mmc.c:218:
+	unsigned limit = 500000;	/* FIXME: real timeout */

WARNING:LINE_SPACING: Missing a blank line after declarations
#1071: FILE: mmc.c:223:
+	u32 e, x;
+	e = cb710_read_port_32(slot, CB710_MMC_STATUS_PORT);

WARNING:LINE_SPACING: Missing a blank line after declarations
#1077: FILE: mmc.c:229:
+			struct cb710_chip *chip = cb710_slot_to_chip(slot);
+			cb710_dump_regs(chip, CB710_DUMP_REGS_MMC);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1097: FILE: mmc.c:249:
+static void cb710_mmc_set_transfer_size(struct cb710_slot *slot,
+	size_t count, size_t blocksize)

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1101: FILE: mmc.c:253:
+	cb710_write_port_32(slot, CB710_MMC_TRANSFER_SIZE_PORT,
+		((count - 1) << 16)|(blocksize - 1));

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#1101: FILE: mmc.c:253:
+		((count - 1) << 16)|(blocksize - 1));
 		                   ^

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1104: FILE: mmc.c:256:
+	dev_vdbg(cb710_slot_dev(slot), "set up for %d block%s of %d bytes\n",
+		count, count == 1 ? "" : "s", blocksize);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1118: FILE: mmc.c:270:
+		cb710_write_port_8(slot, CB710_MMC_STATUS0_PORT,
+			CB710_MMC_S0_FIFO_UNDERFLOW);

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#1127: FILE: mmc.c:279:
+		r1, r2, (r1|r2) ? "BAD (NOT ZERO)!" : "ok");
 		           ^

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1131: FILE: mmc.c:283:
+static int cb710_mmc_receive_pio(struct cb710_slot *slot,
+	struct sg_mapping_iter *miter, size_t dw_count)

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1141: FILE: mmc.c:293:
+	sg_dwiter_write_from_io_le(miter,
+		slot->iobase + CB710_MMC_DATA_PORT, dw_count);

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1158: FILE: mmc.c:310:
+	 * except single 8B block */

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1165: FILE: mmc.c:317:
+	cb710_modify_port_8(slot, CB710_MMC_CONFIG2_PORT,
+		15, CB710_MMC_C2_READ_PIO_SIZE_MASK);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1183: FILE: mmc.c:335:
+		cb710_modify_port_8(slot, CB710_MMC_CONFIG2_PORT,
+			len - 1, CB710_MMC_C2_READ_PIO_SIZE_MASK);

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1202: FILE: mmc.c:354:
+	 * non-16B-boundary blocks */

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1209: FILE: mmc.c:361:
+	cb710_modify_port_8(slot, CB710_MMC_CONFIG2_PORT,
+		0, CB710_MMC_C2_READ_PIO_SIZE_MASK);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1217: FILE: mmc.c:369:
+				err = cb710_wait_for_event(slot,
+					CB710_MMC_S1_PIO_TRANSFER_DONE);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1222: FILE: mmc.c:374:
+			sg_dwiter_read_to_io_le(&miter,
+				slot->iobase + CB710_MMC_DATA_PORT, 4);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1231: FILE: mmc.c:383:
+static u16 cb710_encode_cmd_flags(struct cb710_mmc_reader *reader,
+	struct mmc_command *cmd)

ERROR:TRAILING_STATEMENTS: trailing statements should be on next line
#1243: FILE: mmc.c:395:
+	case MMC_CMD_AC:	cb_flags = CB710_MMC_CMD_AC;	break;

Trailing statements (for example after any conditional) should be
on the next line.
Statements, such as::

  if (x == y) break;

should be::

  if (x == y)
          break;

ERROR:TRAILING_STATEMENTS: trailing statements should be on next line
#1244: FILE: mmc.c:396:
+	case MMC_CMD_ADTC:	cb_flags = CB710_MMC_CMD_ADTC;	break;

ERROR:TRAILING_STATEMENTS: trailing statements should be on next line
#1245: FILE: mmc.c:397:
+	case MMC_CMD_BC:	cb_flags = CB710_MMC_CMD_BC;	break;

ERROR:TRAILING_STATEMENTS: trailing statements should be on next line
#1246: FILE: mmc.c:398:
+	case MMC_CMD_BCR:	cb_flags = CB710_MMC_CMD_BCR;	break;

WARNING:IF_0: Consider removing the code enclosed by this #if 0 and its #endif
#1254: FILE: mmc.c:406:
+#if 0

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1287: FILE: mmc.c:439:
+static void cb710_receive_response(struct cb710_slot *slot,
+	struct mmc_command *cmd)

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1289: FILE: mmc.c:441:
+	unsigned rsp_opcode, wanted_opcode;

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#1301: FILE: mmc.c:453:
+		cmd->resp[0] = (resp[0] << 8)|(resp[1] >> 24);
 		                             ^

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#1302: FILE: mmc.c:454:
+		cmd->resp[1] = (resp[1] << 8)|(resp[2] >> 24);
 		                             ^

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#1303: FILE: mmc.c:455:
+		cmd->resp[2] = (resp[2] << 8)|(resp[3] >> 24);
 		                             ^

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1316: FILE: mmc.c:468:
+static int cb710_mmc_transfer_data(struct cb710_slot *slot,
+	struct mmc_data *data)

WARNING:LINE_SPACING: Missing a blank line after declarations
#1341: FILE: mmc.c:493:
+	u16 cb_cmd = cb710_encode_cmd_flags(reader, cmd);
+	dev_dbg(cb710_slot_dev(slot), "cmd request: 0x%04X\n", cb_cmd);

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#1351: FILE: mmc.c:503:
+	cb710_wait_while_busy(slot, CB710_MMC_S2_BUSY_20|CB710_MMC_S2_BUSY_10);
 	                                                ^

CHECK:COMPARISON_TO_NULL: Comparison to NULL could be written "reader->mrq"
#1381: FILE: mmc.c:533:
+	WARN_ON(reader->mrq != NULL);

Comparisons to NULL in the form (foo == NULL) or (foo != NULL)
are better written as (!foo) and (foo).

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1443: FILE: mmc.c:595:
+	 * (it doesn't depend on write-to-read delay)  --mq */

WARNING:SUSPECT_CODE_INDENT: suspect code indent for conditional statements (8, 8)
#1474: FILE: mmc.c:626:
+	if (ios->power_mode != reader->last_power_mode)
+	switch (ios->power_mode) {

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1480: FILE: mmc.c:632:
+			dev_warn(cb710_slot_dev(slot),
+				"powerup failed (%d)- retrying\n", err);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1486: FILE: mmc.c:638:
+				dev_warn(cb710_slot_dev(slot),
+					"powerup retry failed (%d) - expect errors\n",

WARNING:DEFAULT_NO_BREAK: switch default: should use break
#1495: FILE: mmc.c:647:
+	case MMC_POWER_UP:
+	default:
+		/* ignore */;

switch default case is sometimes written as "default:;".  This can
cause new cases added below default to be defective.

A "break;" should be added after empty default statement to avoid
unwanted fallthrough.

WARNING:SPLIT_STRING: quoted string split across lines
#1527: FILE: mmc.c:679:
+	dev_dbg(cb710_slot_dev(slot), "interrupt; status: %08X, "
+		"ie: %08X, c2: %08X, c1: %08X\n",

Quoted strings that appear as messages in userspace and can be
grepped, should not be split across multiple lines.

See: https://lore.kernel.org/lkml/20120203052727.GA15035@leaf/

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1533: FILE: mmc.c:685:
+		cb710_write_port_8(slot, CB710_MMC_STATUS1_PORT,
+			CB710_MMC_S1_CARD_CHANGED);

CHECK:SPACING: spaces preferred around that '/' (ctx:VxV)
#1536: FILE: mmc.c:688:
+			mmc_detect_change(mmc, HZ/5);
 			                         ^

WARNING:HOTPLUG_SECTION: Using __devinit is unnecessary
#1591: FILE: mmc.c:743:
+static int __devinit cb710_mmc_init(struct platform_device *pdev)

CHECK:CAMELCASE: Avoid CamelCase: <xF>
#1608: FILE: mmc.c:760:
+	val = cb710_src_freq_mhz[(val >> 16) & 0xF];

Avoid CamelCase Identifiers.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#naming

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#1615: FILE: mmc.c:767:
+	mmc->ocr_avail = MMC_VDD_32_33|MMC_VDD_33_34|MMC_VDD_34_35;
 	                              ^

CHECK:SPACING: spaces preferred around that '|' (ctx:VxV)
#1615: FILE: mmc.c:767:
+	mmc->ocr_avail = MMC_VDD_32_33|MMC_VDD_33_34|MMC_VDD_34_35;
 	                                            ^

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1621: FILE: mmc.c:773:
+	tasklet_init(&reader->finish_req_tasklet,
+		cb710_mmc_finish_request_tasklet, (unsigned long)mmc);

WARNING:HOTPLUG_SECTION: Using __devexit is unnecessary
#1644: FILE: mmc.c:796:
+static int __devexit cb710_mmc_exit(struct platform_device *pdev)

CHECK:INVALID_UTF8: Invalid UTF-8, patch and commit message should be encoded in UTF-8
#1690: FILE: mmc.c:842:
+MODULE_AUTHOR("Micha³ Miros³aw <mirq-linux@rere.qmqm.pl>");
                     ^

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#1698: FILE: sgbuf2.c:1:
+/*

WARNING:EMBEDDED_FILENAME: It's generally not useful to have the filename in the file
#1699: FILE: sgbuf2.c:2:
+ *  cb710/sgbuf2.c

CHECK:INVALID_UTF8: Invalid UTF-8, patch and commit message should be encoded in UTF-8
#1701: FILE: sgbuf2.c:4:
+ *  Copyright by Micha³ Miros³aw, 2008
                       ^

CHECK:BRACES: braces {} should be used on all arms of this statement
#1713: FILE: sgbuf2.c:16:
+	if (sg_miter_next(miter)) {
[...]
+	} else
[...]

The placement of braces is stylistically incorrect.
The preferred way is to put the opening brace last on the line,
and put the closing brace first::

  if (x is true) {
          we do y
  }

This applies for all non-functional blocks.
However, there is one special case, namely functions: they have the
opening brace at the beginning of the next line, thus::

  int function(int x)
  {
          body of function
  }

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#placing-braces-and-spaces

CHECK:BRACES: Unbalanced braces around else statement
#1716: FILE: sgbuf2.c:19:
+	} else

CHECK:PREFER_KERNEL_TYPES: Prefer kernel type 'u32' over 'uint32_t'
#1728: FILE: sgbuf2.c:31:
+	uint32_t data;

WARNING:BLOCK_COMMENT_STYLE: Block comments use a trailing */ on a separate line
#1756: FILE: sgbuf2.c:59:
+	 * can do unaligned accesses) */

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#1757: FILE: sgbuf2.c:60:
+	if (likely(len >= 4 && !((unsigned)(miter->addr + miter->consumed) & 3))) {

CHECK:PREFER_KERNEL_TYPES: Prefer kernel type 'u32' over 'uint32_t'
#1768: FILE: sgbuf2.c:71:
+	uint32_t *ptr = NULL;

CHECK:PREFER_KERNEL_TYPES: Prefer kernel type 'u32' over 'uint32_t'
#1796: FILE: sgbuf2.c:99:
+	uint32_t *ptr = NULL;

CHECK:BRACES: braces {} should be used on all arms of this statement
#1798: FILE: sgbuf2.c:101:
+	if (likely(sg_dwiter_get_next_block(miter, &ptr))) {
[...]
+	} else
[...]

CHECK:BRACES: Unbalanced braces around else statement
#1803: FILE: sgbuf2.c:106:
+	} else

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#1815: FILE: sgbuf2.h:1:
+/*

WARNING:EMBEDDED_FILENAME: It's generally not useful to have the filename in the file
#1816: FILE: sgbuf2.h:2:
+ *  cb710/sgbuf2.h

CHECK:INVALID_UTF8: Invalid UTF-8, patch and commit message should be encoded in UTF-8
#1818: FILE: sgbuf2.h:4:
+ *  Copyright by Micha³ Miros³aw, 2008
                       ^

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1850: FILE: sgbuf2.h:36:
+static inline void sg_dwiter_write_from_io_le(struct sg_mapping_iter *miter,
+	void __iomem *port, size_t count)

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1857: FILE: sgbuf2.h:43:
+static inline void sg_dwiter_read_to_io_le(struct sg_mapping_iter *miter,
+	void __iomem *port, size_t count)

./tmp.JOzjvdpBcb//home/fedora/lkml-analysis/lkml/1/patch.offset.0000210798.commit.e10aeb39c1d3567f1906ca36162c977c1b7c0672 total: 5 errors, 66 warnings, 110 checks, 1723 lines checked

NOTE: For some of the reported defects, checkpatch may be able to
      mechanically convert to the typical style using --fix or --fix-inplace.

./tmp.JOzjvdpBcb//home/fedora/lkml-analysis/lkml/1/patch.offset.0000210798.commit.e10aeb39c1d3567f1906ca36162c977c1b7c0672 has style problems, please review.

NOTE: If any of the errors are false positives, please report
      them to the maintainer, see CHECKPATCH in MAINTAINERS.

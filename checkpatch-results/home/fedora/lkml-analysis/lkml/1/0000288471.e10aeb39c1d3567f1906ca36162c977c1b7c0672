WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#170: FILE: arch/s390/mm/hugetlbpage.c:1:
+/*

The source file is missing or has an improper SPDX identifier tag.
The Linux kernel requires the precise SPDX identifier in all source files,
and it is thoroughly documented in the kernel docs.

See: https://www.kernel.org/doc/html/latest/process/license-rules.html

CHECK:LINE_SPACING: Please don't use multiple blank lines
#180: FILE: arch/s390/mm/hugetlbpage.c:11:
+
+

Vertical space is wasted given the limited number of lines an
editor window can display when multiple blank lines are used.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#182: FILE: arch/s390/mm/hugetlbpage.c:13:
+void set_huge_pte_at(struct mm_struct *mm, unsigned long addr,
+				   pte_t *pteptr, pte_t pteval)

CHECK:SPACING: No space is necessary after a cast
#184: FILE: arch/s390/mm/hugetlbpage.c:15:
+	pmd_t *pmdp = (pmd_t *) pteptr;

Whitespace style used in the kernel sources is described in kernel docs.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

CHECK:SPACING: No space is necessary after a cast
#189: FILE: arch/s390/mm/hugetlbpage.c:20:
+		pteptr = (pte_t *) pte_page(pteval)[1].index;

CHECK:SPACING: No space is necessary after a cast
#217: FILE: arch/s390/mm/hugetlbpage.c:48:
+	ptep = (pte_t *) pte_alloc_one(&init_mm, address);

CHECK:SPACING: No space is necessary after a cast
#226: FILE: arch/s390/mm/hugetlbpage.c:57:
+	page[1].index = (unsigned long) ptep;

CHECK:SPACING: No space is necessary after a cast
#237: FILE: arch/s390/mm/hugetlbpage.c:68:
+	ptep = (pte_t *) page[1].index;

CHECK:SPACING: No space is necessary after a cast
#254: FILE: arch/s390/mm/hugetlbpage.c:85:
+	return (pte_t *) pmdp;

CHECK:SPACING: No space is necessary after a cast
#269: FILE: arch/s390/mm/hugetlbpage.c:100:
+	return (pte_t *) pmdp;

CHECK:ARCH_DEFINES: architecture specific defines should be avoided
#388: FILE: arch/s390/mm/vmem.c:148:
+#ifdef __s390x__

Architecture specific defines should be avoided wherever
possible.

CHECK:UNNECESSARY_PARENTHESES: Unnecessary parentheses around 'address >= HPAGE_SIZE'
#389: FILE: arch/s390/mm/vmem.c:149:
+		if (MACHINE_HAS_HPAGE && !(address & ~HPAGE_MASK) &&
+		    (address + HPAGE_SIZE <= start + size) &&
+		    (address >= HPAGE_SIZE)) {

Parentheses are not required in the following cases:

  1. Function pointer uses::

      (foo->bar)();

    could be::

      foo->bar();

  2. Comparisons in if::

      if ((foo->bar) && (foo->baz))
      if ((foo == bar))

    could be::

      if (foo->bar && foo->baz)
      if (foo == bar)

  3. addressof/dereference single Lvalues::

      &(foo->bar)
      *(foo->bar)

    could be::

      &foo->bar
      *foo->bar

CHECK:BRACES: braces {} should be used on all arms of this statement
#468: FILE: arch/s390/mm/vmem.c:410:
+		if (start >= ro_end || end <= ro_start)
[...]
+		else if (start >= ro_start && end <= ro_end)
[...]
+		else if (start >= ro_start) {
[...]
+		} else if (end < ro_end) {
[...]
+		} else {
[...]

The placement of braces is stylistically incorrect.
The preferred way is to put the opening brace last on the line,
and put the closing brace first::

  if (x is true) {
          we do y
  }

This applies for all non-functional blocks.
However, there is one special case, namely functions: they have the
opening brace at the beginning of the next line, thus::

  int function(int x)
  {
          body of function
  }

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#placing-braces-and-spaces

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#506: FILE: include/asm-s390/hugetlb.h:1:
+/*

WARNING:INCLUDE_LINUX: Use #include <linux/pgtable.h> instead of <asm/pgtable.h>
#517: FILE: include/asm-s390/hugetlb.h:12:
+#include <asm/pgtable.h>

CHECK:LINE_SPACING: Please don't use multiple blank lines
#519: FILE: include/asm-s390/hugetlb.h:14:
+
+

CHECK:SPACING: No space is necessary after a cast
#588: FILE: include/asm-s390/hugetlb.h:83:
+		ptep = (pte_t *) (pte_val(pte) & _SEGMENT_ENTRY_ORIGIN);

CHECK:SPACING: No space is necessary after a cast
#604: FILE: include/asm-s390/hugetlb.h:99:
+	pmd_clear((pmd_t *) ptep);

CHECK:SPACING: No space is necessary after a cast
#613: FILE: include/asm-s390/hugetlb.h:108:
+	register unsigned long reg4 asm("4") = ((unsigned long) pmdp) + 5;

CHECK:OPEN_ENDED_LINE: Lines should not end with a '('
#615: FILE: include/asm-s390/hugetlb.h:110:
+	asm volatile(

CHECK:SPACING: No space is necessary after a cast
#624: FILE: include/asm-s390/hugetlb.h:119:
+	unsigned long sto = (unsigned long) pmdp -

CHECK:OPEN_ENDED_LINE: Lines should not end with a '('
#628: FILE: include/asm-s390/hugetlb.h:123:
+		asm volatile(

CHECK:SPACING: No space is necessary after a cast
#641: FILE: include/asm-s390/hugetlb.h:136:
+	pmd_t *pmdp = (pmd_t *) ptep;

WARNING:RETURN_VOID: void function return statements are not generally useful
#658: FILE: include/asm-s390/hugetlb.h:153:
+	return;
+}

CHECK:MACRO_ARG_REUSE: Macro argument reuse '__vma' - possible side-effects?
#660: FILE: include/asm-s390/hugetlb.h:155:
+#define huge_ptep_set_access_flags(__vma, __addr, __ptep, __entry, __dirty) \
+({									    \
+	int __changed = !pte_same(huge_ptep_get(__ptep), __entry);	    \
+	if (__changed) {						    \
+		huge_ptep_invalidate((__vma)->vm_mm, __addr, __ptep);	    \
+		set_huge_pte_at((__vma)->vm_mm, __addr, __ptep, __entry);   \
+	}								    \
+	__changed;							    \
+})

CHECK:MACRO_ARG_REUSE: Macro argument reuse '__addr' - possible side-effects?
#660: FILE: include/asm-s390/hugetlb.h:155:
+#define huge_ptep_set_access_flags(__vma, __addr, __ptep, __entry, __dirty) \
+({									    \
+	int __changed = !pte_same(huge_ptep_get(__ptep), __entry);	    \
+	if (__changed) {						    \
+		huge_ptep_invalidate((__vma)->vm_mm, __addr, __ptep);	    \
+		set_huge_pte_at((__vma)->vm_mm, __addr, __ptep, __entry);   \
+	}								    \
+	__changed;							    \
+})

CHECK:MACRO_ARG_REUSE: Macro argument reuse '__ptep' - possible side-effects?
#660: FILE: include/asm-s390/hugetlb.h:155:
+#define huge_ptep_set_access_flags(__vma, __addr, __ptep, __entry, __dirty) \
+({									    \
+	int __changed = !pte_same(huge_ptep_get(__ptep), __entry);	    \
+	if (__changed) {						    \
+		huge_ptep_invalidate((__vma)->vm_mm, __addr, __ptep);	    \
+		set_huge_pte_at((__vma)->vm_mm, __addr, __ptep, __entry);   \
+	}								    \
+	__changed;							    \
+})

CHECK:MACRO_ARG_REUSE: Macro argument reuse '__entry' - possible side-effects?
#660: FILE: include/asm-s390/hugetlb.h:155:
+#define huge_ptep_set_access_flags(__vma, __addr, __ptep, __entry, __dirty) \
+({									    \
+	int __changed = !pte_same(huge_ptep_get(__ptep), __entry);	    \
+	if (__changed) {						    \
+		huge_ptep_invalidate((__vma)->vm_mm, __addr, __ptep);	    \
+		set_huge_pte_at((__vma)->vm_mm, __addr, __ptep, __entry);   \
+	}								    \
+	__changed;							    \
+})

CHECK:MACRO_ARG_REUSE: Macro argument reuse '__mm' - possible side-effects?
#670: FILE: include/asm-s390/hugetlb.h:165:
+#define huge_ptep_set_wrprotect(__mm, __addr, __ptep)			\
+({									\
+	pte_t __pte = huge_ptep_get(__ptep);				\
+	if (pte_write(__pte)) {						\
+		if (atomic_read(&(__mm)->mm_users) > 1 ||		\
+		    (__mm) != current->active_mm)			\
+			huge_ptep_invalidate(__mm, __addr, __ptep);	\
+		set_huge_pte_at(__mm, __addr, __ptep,			\
+				huge_pte_wrprotect(__pte));		\
+	}								\
+})

CHECK:MACRO_ARG_REUSE: Macro argument reuse '__addr' - possible side-effects?
#670: FILE: include/asm-s390/hugetlb.h:165:
+#define huge_ptep_set_wrprotect(__mm, __addr, __ptep)			\
+({									\
+	pte_t __pte = huge_ptep_get(__ptep);				\
+	if (pte_write(__pte)) {						\
+		if (atomic_read(&(__mm)->mm_users) > 1 ||		\
+		    (__mm) != current->active_mm)			\
+			huge_ptep_invalidate(__mm, __addr, __ptep);	\
+		set_huge_pte_at(__mm, __addr, __ptep,			\
+				huge_pte_wrprotect(__pte));		\
+	}								\
+})

CHECK:MACRO_ARG_REUSE: Macro argument reuse '__ptep' - possible side-effects?
#670: FILE: include/asm-s390/hugetlb.h:165:
+#define huge_ptep_set_wrprotect(__mm, __addr, __ptep)			\
+({									\
+	pte_t __pte = huge_ptep_get(__ptep);				\
+	if (pte_write(__pte)) {						\
+		if (atomic_read(&(__mm)->mm_users) > 1 ||		\
+		    (__mm) != current->active_mm)			\
+			huge_ptep_invalidate(__mm, __addr, __ptep);	\
+		set_huge_pte_at(__mm, __addr, __ptep,			\
+				huge_pte_wrprotect(__pte));		\
+	}								\
+})

CHECK:BIT_MACRO: Prefer using the BIT macro
#698: FILE: include/asm-s390/page.h:23:
+#define HPAGE_SIZE	(1UL << HPAGE_SHIFT)

Defines like: 1 << <digit> could be BIT(digit).
The BIT() macro is defined via include/linux/bits.h::

  #define BIT(nr)         (1UL << (nr))

ERROR:DEFINE_ARCH_HAS: #define of 'ARCH_HAS_SETCLEAR_HUGE_PTE' is wrong - use Kconfig variables or standard guards instead
#702: FILE: include/asm-s390/page.h:27:
+#define ARCH_HAS_SETCLEAR_HUGE_PTE

The ARCH_HAS_xyz and ARCH_HAVE_xyz patterns are wrong.

For big conceptual features use Kconfig symbols instead.  And for
smaller things where we have compatibility fallback functions but
want architectures able to override them with optimized ones, we
should either use weak functions (appropriate for some cases), or
the symbol that protects them should be the same symbol we use.

See: https://lore.kernel.org/lkml/CA+55aFycQ9XJvEOsiM3txHL5bjUc8CeKWJNR_H+MiicaddB42Q@mail.gmail.com/

ERROR:DEFINE_ARCH_HAS: #define of 'ARCH_HAS_HUGE_PTE_TYPE' is wrong - use Kconfig variables or standard guards instead
#703: FILE: include/asm-s390/page.h:28:
+#define ARCH_HAS_HUGE_PTE_TYPE

ERROR:DEFINE_ARCH_HAS: #define of 'ARCH_HAS_PREPARE_HUGEPAGE' is wrong - use Kconfig variables or standard guards instead
#704: FILE: include/asm-s390/page.h:29:
+#define ARCH_HAS_PREPARE_HUGEPAGE

ERROR:DEFINE_ARCH_HAS: #define of 'ARCH_HAS_HUGEPAGE_CLEAR_FLUSH' is wrong - use Kconfig variables or standard guards instead
#705: FILE: include/asm-s390/page.h:30:
+#define ARCH_HAS_HUGEPAGE_CLEAR_FLUSH

CHECK:OPEN_ENDED_LINE: Lines should not end with a '('
#719: FILE: include/asm-s390/page.h:38:
+		asm volatile(

CHECK:OPEN_ENDED_LINE: Lines should not end with a '('
#726: FILE: include/asm-s390/page.h:45:
+		asm volatile(

CHECK:BIT_MACRO: Prefer using the BIT macro
#772: FILE: include/asm-s390/setup.h:72:
+#define MACHINE_FLAG_HPAGE	(1UL << 10)

CHECK:BIT_MACRO: Prefer using the BIT macro
#773: FILE: include/asm-s390/setup.h:73:
+#define MACHINE_FLAG_PFMF	(1UL << 11)

./tmp.JOzjvdpBcb//home/fedora/lkml-analysis/lkml/1/patch.offset.0000288471.commit.e10aeb39c1d3567f1906ca36162c977c1b7c0672 total: 4 errors, 4 warnings, 32 checks, 666 lines checked

NOTE: For some of the reported defects, checkpatch may be able to
      mechanically convert to the typical style using --fix or --fix-inplace.

./tmp.JOzjvdpBcb//home/fedora/lkml-analysis/lkml/1/patch.offset.0000288471.commit.e10aeb39c1d3567f1906ca36162c977c1b7c0672 has style problems, please review.

NOTE: If any of the errors are false positives, please report
      them to the maintainer, see CHECKPATCH in MAINTAINERS.

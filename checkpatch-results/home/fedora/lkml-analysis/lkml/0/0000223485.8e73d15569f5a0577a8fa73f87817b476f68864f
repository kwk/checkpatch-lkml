WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#40: FILE: drivers/infiniband/hw/mthca/mthca_av.c:1:
+/*

The source file is missing or has an improper SPDX identifier tag.
The Linux kernel requires the precise SPDX identifier in all source files,
and it is thoroughly documented in the kernel docs.

See: https://www.kernel.org/doc/html/latest/process/license-rules.html

WARNING:CVS_KEYWORD: CVS style keyword markers, these will _not_ be updated
#60: FILE: drivers/infiniband/hw/mthca/mthca_av.c:21:
+ * $Id: mthca_av.c 1298 2004-11-29 03:26:10Z roland $

Since linux moved to git, the CVS markers are no longer used.
So, CVS style keywords ($Id$, $Revision$, $Log$) should not be
added.

WARNING:SIZEOF_PARENTHESIS: sizeof *av should be sizeof(*av)
#101: FILE: drivers/infiniband/hw/mthca/mthca_av.c:62:
+		av = kmalloc(sizeof *av, GFP_KERNEL);

ERROR:TRAILING_WHITESPACE: trailing whitespace
#104: FILE: drivers/infiniband/hw/mthca/mthca_av.c:65:
+^I^I^I$

Trailing whitespace should always be removed.
Some editors highlight the trailing whitespace and cause visual
distractions when editing files.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

ERROR:TRAILING_WHITESPACE: trailing whitespace
#143: FILE: drivers/infiniband/hw/mthca/mthca_av.c:104:
+^I^I$

CHECK:SPACING: No space is necessary after a cast
#145: FILE: drivers/infiniband/hw/mthca/mthca_av.c:106:
+			  av, (unsigned long) ah->avdma);

Whitespace style used in the kernel sources is described in kernel docs.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

WARNING:PREFER_PR_LEVEL: Prefer [subsystem eg: netdev]_dbg([subsystem]dev, ... then dev_dbg(dev, ... then pr_debug(...  to printk(KERN_DEBUG ...
#147: FILE: drivers/infiniband/hw/mthca/mthca_av.c:108:
+			printk(KERN_DEBUG "  [%2x] %08x\n",

CHECK:SPACING: No space is necessary after a cast
#148: FILE: drivers/infiniband/hw/mthca/mthca_av.c:109:
+			       j * 4, be32_to_cpu(((u32 *) av)[j]));

ERROR:CODE_INDENT: code indent should use tabs where possible
#164: FILE: drivers/infiniband/hw/mthca/mthca_av.c:125:
+ ^I^I^I   (ah->avdma - dev->av_table.ddr_av_base) /$

Code indent should use tabs instead of spaces.
Outside of comments, documentation and Kconfig,
spaces are never used for indentation.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#indentation

WARNING:SPACE_BEFORE_TAB: please, no space before tabs
#164: FILE: drivers/infiniband/hw/mthca/mthca_av.c:125:
+ ^I^I^I   (ah->avdma - dev->av_table.ddr_av_base) /$

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#164: FILE: drivers/infiniband/hw/mthca/mthca_av.c:125:
+		mthca_free(&dev->av_table.alloc,
+ 			   (ah->avdma - dev->av_table.ddr_av_base) /

WARNING:LEADING_SPACE: please, no spaces at the start of a line
#164: FILE: drivers/infiniband/hw/mthca/mthca_av.c:125:
+ ^I^I^I   (ah->avdma - dev->av_table.ddr_av_base) /$

WARNING:HOTPLUG_SECTION: Using __devinit is unnecessary
#200: FILE: drivers/infiniband/hw/mthca/mthca_av.c:161:
+int __devinit mthca_init_av_table(struct mthca_dev *dev)

CHECK:BRACES: braces {} should be used on all arms of this statement
#217: FILE: drivers/infiniband/hw/mthca/mthca_av.c:178:
+	if (!(dev->mthca_flags & MTHCA_FLAG_DDR_HIDDEN)) {
[...]
+	} else
[...]

The placement of braces is stylistically incorrect.
The preferred way is to put the opening brace last on the line,
and put the closing brace first::

  if (x is true) {
          we do y
  }

This applies for all non-functional blocks.
However, there is one special case, namely functions: they have the
opening brace at the beginning of the next line, thus::

  int function(int x)
  {
          body of function
  }

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#placing-braces-and-spaces

CHECK:BRACES: Unbalanced braces around else statement
#225: FILE: drivers/infiniband/hw/mthca/mthca_av.c:186:
+	} else

WARNING:HOTPLUG_SECTION: Using __devexit is unnecessary
#238: FILE: drivers/infiniband/hw/mthca/mthca_av.c:199:
+void __devexit mthca_cleanup_av_table(struct mthca_dev *dev)

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#248: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:1:
+/*

WARNING:CVS_KEYWORD: CVS style keyword markers, these will _not_ be updated
#268: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:21:
+ * $Id: mthca_mcg.c 1298 2004-11-29 03:26:10Z roland $

WARNING:SPLIT_STRING: quoted string split across lines
#331: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:84:
+		mthca_dbg(dev, "Hash for %04x:%04x:%04x:%04x:"
+			  "%04x:%04x:%04x:%04x is %04x\n",

Quoted strings that appear as messages in userspace and can be
grepped, should not be split across multiple lines.

See: https://lore.kernel.org/lkml/20120203052727.GA15035@leaf/

CHECK:SPACING: No space is necessary after a cast
#332: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:85:
+			  be16_to_cpu(((u16 *) gid)[0]), be16_to_cpu(((u16 *) gid)[1]),

CHECK:SPACING: No space is necessary after a cast
#333: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:86:
+			  be16_to_cpu(((u16 *) gid)[2]), be16_to_cpu(((u16 *) gid)[3]),

CHECK:SPACING: No space is necessary after a cast
#334: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:87:
+			  be16_to_cpu(((u16 *) gid)[4]), be16_to_cpu(((u16 *) gid)[5]),

CHECK:SPACING: No space is necessary after a cast
#335: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:88:
+			  be16_to_cpu(((u16 *) gid)[6]), be16_to_cpu(((u16 *) gid)[7]),

WARNING:SIZEOF_PARENTHESIS: sizeof *mgm should be sizeof(*mgm)
#384: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:137:
+	mailbox = kmalloc(sizeof *mgm + MTHCA_CMD_MAILBOX_EXTRA, GFP_KERNEL);

WARNING:SIZEOF_PARENTHESIS: sizeof *mgm should be sizeof(*mgm)
#481: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:234:
+	mailbox = kmalloc(sizeof *mgm + MTHCA_CMD_MAILBOX_EXTRA, GFP_KERNEL);

ERROR:TRAILING_WHITESPACE: trailing whitespace
#493: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:246:
+^Iif (index == -1) {^I$

WARNING:SPLIT_STRING: quoted string split across lines
#495: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:248:
+		mthca_err(dev, "MGID %04x:%04x:%04x:%04x:%04x:%04x:%04x:%04x "
+			  "not found\n",

CHECK:SPACING: No space is necessary after a cast
#496: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:249:
+			  be16_to_cpu(((u16 *) gid->raw)[0]),

CHECK:SPACING: No space is necessary after a cast
#497: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:250:
+			  be16_to_cpu(((u16 *) gid->raw)[1]),

CHECK:SPACING: No space is necessary after a cast
#498: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:251:
+			  be16_to_cpu(((u16 *) gid->raw)[2]),

CHECK:SPACING: No space is necessary after a cast
#499: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:252:
+			  be16_to_cpu(((u16 *) gid->raw)[3]),

CHECK:SPACING: No space is necessary after a cast
#500: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:253:
+			  be16_to_cpu(((u16 *) gid->raw)[4]),

CHECK:SPACING: No space is necessary after a cast
#501: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:254:
+			  be16_to_cpu(((u16 *) gid->raw)[5]),

CHECK:SPACING: No space is necessary after a cast
#502: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:255:
+			  be16_to_cpu(((u16 *) gid->raw)[6]),

CHECK:SPACING: No space is necessary after a cast
#503: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:256:
+			  be16_to_cpu(((u16 *) gid->raw)[7]));

CHECK:BRACES: braces {} should be used on all arms of this statement
#540: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:293:
+		if (be32_to_cpu(mgm->next_gid_index) >> 5) {
[...]
+		} else
[...]

CHECK:BRACES: Unbalanced braces around else statement
#552: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:305:
+		} else

WARNING:HOTPLUG_SECTION: Using __devinit is unnecessary
#593: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:346:
+int __devinit mthca_init_mcg_table(struct mthca_dev *dev)

WARNING:HOTPLUG_SECTION: Using __devexit is unnecessary
#609: FILE: drivers/infiniband/hw/mthca/mthca_mcg.c:362:
+void __devexit mthca_cleanup_mcg_table(struct mthca_dev *dev)

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#616: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:1:
+/*

WARNING:CVS_KEYWORD: CVS style keyword markers, these will _not_ be updated
#636: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:21:
+ * $Id: mthca_mr.c 1298 2004-11-29 03:26:10Z roland $

WARNING:PREFER_DEFINED_ATTRIBUTE_MACRO: Prefer __packed over __attribute__((packed))
#661: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:46:
+} __attribute__((packed));

CHECK:BIT_MACRO: Prefer using the BIT macro
#664: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:49:
+#define MTHCA_MPT_FLAG_MIO           (1 << 17)

Defines like: 1 << <digit> could be BIT(digit).
The BIT() macro is defined via include/linux/bits.h::

  #define BIT(nr)         (1UL << (nr))

CHECK:BIT_MACRO: Prefer using the BIT macro
#665: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:50:
+#define MTHCA_MPT_FLAG_BIND_ENABLE   (1 << 15)

CHECK:BIT_MACRO: Prefer using the BIT macro
#666: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:51:
+#define MTHCA_MPT_FLAG_PHYSICAL      (1 <<  9)

CHECK:BIT_MACRO: Prefer using the BIT macro
#667: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:52:
+#define MTHCA_MPT_FLAG_REGION        (1 <<  8)

ERROR:TRAILING_WHITESPACE: trailing whitespace
#703: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:88:
+^I^I^I^I^I  $

WARNING:SIZEOF_PARENTHESIS: sizeof *mpt_entry should be sizeof(*mpt_entry)
#744: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:129:
+	mailbox = kmalloc(sizeof *mpt_entry + MTHCA_CMD_MAILBOX_EXTRA,

WARNING:SIZEOF_PARENTHESIS: sizeof *mpt_entry should be sizeof(*mpt_entry)
#764: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:149:
+	       sizeof *mpt_entry - offsetof(struct mthca_mpt_entry, lkey));

CHECK:BRACES: braces {} should be used on all arms of this statement
#769: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:154:
+	if (err)
[...]
+	else if (status) {
[...]

WARNING:SUSPECT_CODE_INDENT: suspect code indent for conditional statements (8, 30)
#801: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:186:
+	for (i = dev->limits.mtt_seg_size / 8, mr->order = 0;
[...]
+		/* nothing */ ;

WARNING:SPACING: space prohibited before semicolon
#804: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:189:
+		/* nothing */ ;

WARNING:SIZEOF_PARENTHESIS: sizeof *mpt_entry should be sizeof(*mpt_entry)
#814: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:199:
+	mailbox = kmalloc(max(sizeof *mpt_entry,

CHECK:SPACING: No space is necessary after a cast
#815: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:200:
+			      (size_t) 8 * (list_len + (list_len & 1) + 2)) +

WARNING:PREFER_PR_LEVEL: Prefer [subsystem eg: netdev]_err([subsystem]dev, ... then dev_err(dev, ... then pr_err(...  to printk(KERN_ERR ...
#837: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:222:
+			printk(KERN_ERR "[%2d] %016llx\n",

CHECK:SPACING: No space is necessary after a cast
#838: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:223:
+			       i, (unsigned long long) be64_to_cpu(mtt_entry[i]));

WARNING:SIZEOF_PARENTHESIS: sizeof *mpt_entry should be sizeof(*mpt_entry)
#866: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:251:
+	       sizeof *mpt_entry - offsetof(struct mthca_mpt_entry, lkey));

WARNING:SPACING: space prohibited between function name and open parenthesis '('
#872: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:257:
+		for (i = 0; i < sizeof (struct mthca_mpt_entry) / 4; ++i) {

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#874: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:259:
+				printk("[%02x] ", i * 4);

CHECK:SPACING: No space is necessary after a cast
#875: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:260:
+			printk(" %08x", be32_to_cpu(((u32 *) mpt_entry)[i]));

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#875: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:260:
+			printk(" %08x", be32_to_cpu(((u32 *) mpt_entry)[i]));

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#877: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:262:
+				printk("\n");

CHECK:BRACES: braces {} should be used on all arms of this statement
#884: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:269:
+	if (err)
[...]
+	else if (status) {
[...]

ERROR:TRAILING_WHITESPACE: trailing whitespace
#925: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:310:
+^Imthca_free(&dev->mr_table.mpt_alloc, mr->ibmr.lkey);^I^I   $

WARNING:HOTPLUG_SECTION: Using __devinit is unnecessary
#928: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:313:
+int __devinit mthca_init_mr_table(struct mthca_dev *dev)

WARNING:SUSPECT_CODE_INDENT: suspect code indent for conditional statements (8, 30)
#941: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:326:
+	for (i = 1, dev->mr_table.max_mtt_order = 0;
[...]
+		/* nothing */ ;

WARNING:SPACING: space prohibited before semicolon
#944: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:329:
+		/* nothing */ ;

WARNING:SPACING: space prohibited between function name and open parenthesis '('
#947: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:332:
+					  sizeof (long *),

WARNING:SPACING: space prohibited between function name and open parenthesis '('
#957: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:342:
+		dev->mr_table.mtt_buddy[i] = kmalloc(s * sizeof (long),

WARNING:ALLOC_WITH_MULTIPLY: Prefer kmalloc_array over kmalloc with multiply
#957: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:342:
+		dev->mr_table.mtt_buddy[i] = kmalloc(s * sizeof (long),
+						     GFP_KERNEL);

Prefer kmalloc_array/kcalloc over kmalloc/kzalloc with a
sizeof multiply.

See: https://www.kernel.org/doc/html/latest/core-api/memory-allocation.html

WARNING:SPLIT_STRING: quoted string split across lines
#973: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:358:
+		mthca_err(dev, "MTT table of order %d is "
+			  "too small.\n", i);

CHECK:SPACING: No space is necessary after a cast
#977: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:362:
+	(void) mthca_alloc_mtt(dev, i);

WARNING:HOTPLUG_SECTION: Using __devexit is unnecessary
#991: FILE: drivers/infiniband/hw/mthca/mthca_mr.c:376:
+void __devexit mthca_cleanup_mr_table(struct mthca_dev *dev)

WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#1004: FILE: drivers/infiniband/hw/mthca/mthca_pd.c:1:
+/*

WARNING:CVS_KEYWORD: CVS style keyword markers, these will _not_ be updated
#1024: FILE: drivers/infiniband/hw/mthca/mthca_pd.c:21:
+ * $Id: mthca_pd.c 1288 2004-11-24 01:12:39Z roland $

WARNING:HOTPLUG_SECTION: Using __devinit is unnecessary
#1060: FILE: drivers/infiniband/hw/mthca/mthca_pd.c:57:
+int __devinit mthca_init_pd_table(struct mthca_dev *dev)

WARNING:HOTPLUG_SECTION: Using __devexit is unnecessary
#1068: FILE: drivers/infiniband/hw/mthca/mthca_pd.c:65:
+void __devexit mthca_cleanup_pd_table(struct mthca_dev *dev)

./tmp.EfiDkiSq0Q//home/fedora/lkml-analysis/lkml/0/patch.offset.0000223485.commit.8e73d15569f5a0577a8fa73f87817b476f68864f total: 6 errors, 42 warnings, 29 checks, 1024 lines checked

NOTE: For some of the reported defects, checkpatch may be able to
      mechanically convert to the typical style using --fix or --fix-inplace.

NOTE: Whitespace errors detected.
      You may wish to use scripts/cleanpatch or scripts/cleanfile

./tmp.EfiDkiSq0Q//home/fedora/lkml-analysis/lkml/0/patch.offset.0000223485.commit.8e73d15569f5a0577a8fa73f87817b476f68864f has style problems, please review.

NOTE: If any of the errors are false positives, please report
      them to the maintainer, see CHECKPATCH in MAINTAINERS.

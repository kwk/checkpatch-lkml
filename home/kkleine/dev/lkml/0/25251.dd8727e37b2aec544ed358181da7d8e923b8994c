WARNING:SPDX_LICENSE_TAG: Missing or malformed SPDX-License-Identifier tag in line 1
#35: FILE: drivers/kvm/kvm_main.c:1:
+/*

The source file is missing or has an improper SPDX identifier tag.
The Linux kernel requires the precise SPDX identifier in all source files,
and it is thoroughly documented in the kernel docs.

See: https://www.kernel.org/doc/html/latest/process/license-rules.html

WARNING:INCLUDE_LINUX: Use #include <linux/processor.h> instead of <asm/processor.h>
#54: FILE: drivers/kvm/kvm_main.c:20:
+#include <asm/processor.h>

WARNING:INCLUDE_LINUX: Use #include <linux/uaccess.h> instead of <asm/uaccess.h>
#61: FILE: drivers/kvm/kvm_main.c:27:
+#include <asm/uaccess.h>

WARNING:INCLUDE_LINUX: Use #include <linux/io.h> instead of <asm/io.h>
#63: FILE: drivers/kvm/kvm_main.c:29:
+#include <asm/io.h>

CHECK:LINE_SPACING: Please use a blank line after function/struct/union/enum declarations
#94: FILE: drivers/kvm/kvm_main.c:60:
+};
+#define NR_VMX_MSR (sizeof(vmx_msr_index) / sizeof(*vmx_msr_index))

Vertical space is wasted given the limited number of lines an
editor window can display when multiple blank lines are used.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

CHECK:LINE_SPACING: Please don't use multiple blank lines
#96: FILE: drivers/kvm/kvm_main.c:62:
+
+

CHECK:SPACING: spaces preferred around that '-' (ctx:VxV)
#102: FILE: drivers/kvm/kvm_main.c:68:
+#define NUM_AUTO_MSRS (NR_VMX_MSR-2)
                                  ^

Whitespace style used in the kernel sources is described in kernel docs.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

ERROR:POINTER_LOCATION: "foo* bar" should be "foo *bar"
#113: FILE: drivers/kvm/kvm_main.c:79:
+static int rmode_tss_base(struct kvm* kvm);

When using pointer data or a function that returns a pointer type,
the preferred use of * is adjacent to the data name or function name
and not adjacent to the type name.
Examples::

  char *linux_banner;
  unsigned long long memparse(char *ptr, char **retptr);
  char *match_strdup(substring_t *s);

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#spaces

WARNING:PREFER_DEFINED_ATTRIBUTE_MACRO: Prefer __packed over __attribute__((packed))
#137: FILE: drivers/kvm/kvm_main.c:103:
+} __attribute__((packed));

ERROR:SPACING: space prohibited after that open parenthesis '('
#141: FILE: drivers/kvm/kvm_main.c:107:
+	asm ( "sgdt %0" : "=m"(*table) );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#141: FILE: drivers/kvm/kvm_main.c:107:
+	asm ( "sgdt %0" : "=m"(*table) );

ERROR:SPACING: space prohibited after that open parenthesis '('
#146: FILE: drivers/kvm/kvm_main.c:112:
+	asm ( "sidt %0" : "=m"(*table) );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#146: FILE: drivers/kvm/kvm_main.c:112:
+	asm ( "sidt %0" : "=m"(*table) );

WARNING:LINE_SPACING: Missing a blank line after declarations
#152: FILE: drivers/kvm/kvm_main.c:118:
+	u16 seg;
+	asm ( "mov %%fs, %0" : "=g"(seg) );

ERROR:SPACING: space prohibited after that open parenthesis '('
#152: FILE: drivers/kvm/kvm_main.c:118:
+	asm ( "mov %%fs, %0" : "=g"(seg) );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#152: FILE: drivers/kvm/kvm_main.c:118:
+	asm ( "mov %%fs, %0" : "=g"(seg) );

WARNING:LINE_SPACING: Missing a blank line after declarations
#159: FILE: drivers/kvm/kvm_main.c:125:
+	u16 seg;
+	asm ( "mov %%gs, %0" : "=g"(seg) );

ERROR:SPACING: space prohibited after that open parenthesis '('
#159: FILE: drivers/kvm/kvm_main.c:125:
+	asm ( "mov %%gs, %0" : "=g"(seg) );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#159: FILE: drivers/kvm/kvm_main.c:125:
+	asm ( "mov %%gs, %0" : "=g"(seg) );

WARNING:LINE_SPACING: Missing a blank line after declarations
#166: FILE: drivers/kvm/kvm_main.c:132:
+	u16 ldt;
+	asm ( "sldt %0" : "=g"(ldt) );

ERROR:SPACING: space prohibited after that open parenthesis '('
#166: FILE: drivers/kvm/kvm_main.c:132:
+	asm ( "sldt %0" : "=g"(ldt) );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#166: FILE: drivers/kvm/kvm_main.c:132:
+	asm ( "sldt %0" : "=g"(ldt) );

ERROR:SPACING: space prohibited after that open parenthesis '('
#172: FILE: drivers/kvm/kvm_main.c:138:
+	asm ( "mov %0, %%fs\n" : : "g"(sel) );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#172: FILE: drivers/kvm/kvm_main.c:138:
+	asm ( "mov %0, %%fs\n" : : "g"(sel) );

ERROR:SPACING: space prohibited after that open parenthesis '('
#177: FILE: drivers/kvm/kvm_main.c:143:
+	asm ( "mov %0, %%gs\n" : : "g"(sel) );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#177: FILE: drivers/kvm/kvm_main.c:143:
+	asm ( "mov %0, %%gs\n" : : "g"(sel) );

ERROR:SPACING: space prohibited after that open parenthesis '('
#183: FILE: drivers/kvm/kvm_main.c:149:
+	asm ( "lldt %0" : : "g"(sel) );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#183: FILE: drivers/kvm/kvm_main.c:149:
+	asm ( "lldt %0" : : "g"(sel) );

ERROR:SPACING: space prohibited after that open parenthesis '('
#189: FILE: drivers/kvm/kvm_main.c:155:
+	asm ( "fxsave (%0)":: "r" (image));

ERROR:SPACING: space prohibited after that open parenthesis '('
#194: FILE: drivers/kvm/kvm_main.c:160:
+	asm ( "fxrstor (%0)":: "r" (image));

ERROR:SPACING: space prohibited after that open parenthesis '('
#199: FILE: drivers/kvm/kvm_main.c:165:
+	asm ( "finit" );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#199: FILE: drivers/kvm/kvm_main.c:165:
+	asm ( "finit" );

WARNING:PREFER_DEFINED_ATTRIBUTE_MACRO: Prefer __packed over __attribute__((packed))
#216: FILE: drivers/kvm/kvm_main.c:182:
+} __attribute__((packed));

WARNING:PREFER_DEFINED_ATTRIBUTE_MACRO: Prefer __packed over __attribute__((packed))
#224: FILE: drivers/kvm/kvm_main.c:190:
+} __attribute__((packed));

WARNING:NEW_TYPEDEFS: do not add new typedefs
#233: FILE: drivers/kvm/kvm_main.c:199:
+	typedef unsigned long ul;

ERROR:SPACING: space prohibited after that open parenthesis '('
#236: FILE: drivers/kvm/kvm_main.c:202:
+	asm ( "sgdt %0" : "=m"(gdt) );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#236: FILE: drivers/kvm/kvm_main.c:202:
+	asm ( "sgdt %0" : "=m"(gdt) );

ERROR:SPACING: space prohibited after that open parenthesis '('
#242: FILE: drivers/kvm/kvm_main.c:208:
+		asm ( "sldt %0" : "=g"(ldt_selector) );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#242: FILE: drivers/kvm/kvm_main.c:208:
+		asm ( "sldt %0" : "=g"(ldt_selector) );

CHECK:LOGICAL_CONTINUATIONS: Logical continuations should be on the previous line
#249: FILE: drivers/kvm/kvm_main.c:215:
+	if (d->system == 0
+	    && (d->type == 2 || d->type == 9 || d->type == 11))

WARNING:LINE_SPACING: Missing a blank line after declarations
#258: FILE: drivers/kvm/kvm_main.c:224:
+	u16 tr;
+	asm ( "str %0" : "=g"(tr) );

ERROR:SPACING: space prohibited after that open parenthesis '('
#258: FILE: drivers/kvm/kvm_main.c:224:
+	asm ( "str %0" : "=g"(tr) );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#258: FILE: drivers/kvm/kvm_main.c:224:
+	asm ( "str %0" : "=g"(tr) );

WARNING:SPACE_BEFORE_TAB: please, no space before tabs
#288: FILE: drivers/kvm/kvm_main.c:254:
+#define MSR_IA32_FEATURE_CONTROL ^I^I0x03a$

WARNING:SPACE_BEFORE_TAB: please, no space before tabs
#289: FILE: drivers/kvm/kvm_main.c:255:
+#define MSR_IA32_VMX_BASIC_MSR   ^I^I0x480$

WARNING:LINE_SPACING: Missing a blank line after declarations
#308: FILE: drivers/kvm/kvm_main.c:274:
+	struct kvm_memory_slot *slot = gfn_to_memslot(kvm, gfn);
+	return (slot) ? slot->phys_mem[gfn - slot->base_gfn] : 0;

CHECK:LINE_SPACING: Please don't use multiple blank lines
#311: FILE: drivers/kvm/kvm_main.c:277:
+
+

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#314: FILE: drivers/kvm/kvm_main.c:280:
+int kvm_read_guest(struct kvm_vcpu *vcpu,
+			     gva_t addr,

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#323: FILE: drivers/kvm/kvm_main.c:289:
+		unsigned now;

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#324: FILE: drivers/kvm/kvm_main.c:290:
+		unsigned offset;

CHECK:OPEN_ENDED_LINE: Lines should not end with a '('
#332: FILE: drivers/kvm/kvm_main.c:298:
+		guest_buf = (hva_t)kmap_atomic(

ERROR:POINTER_LOCATION: "(foo*)" should be "(foo *)"
#338: FILE: drivers/kvm/kvm_main.c:304:
+		memcpy(host_buf, (void*)guest_buf, now);

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#348: FILE: drivers/kvm/kvm_main.c:314:
+int kvm_write_guest(struct kvm_vcpu *vcpu,
+			     gva_t addr,

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#357: FILE: drivers/kvm/kvm_main.c:323:
+		unsigned now;

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#358: FILE: drivers/kvm/kvm_main.c:324:
+		unsigned offset;

CHECK:OPEN_ENDED_LINE: Lines should not end with a '('
#366: FILE: drivers/kvm/kvm_main.c:332:
+		guest_buf = (hva_t)kmap_atomic(

ERROR:POINTER_LOCATION: "(foo*)" should be "(foo *)"
#371: FILE: drivers/kvm/kvm_main.c:337:
+		memcpy((void*)guest_buf, host_buf, now);

ERROR:SPACING: space prohibited after that open parenthesis '('
#395: FILE: drivers/kvm/kvm_main.c:361:
+	asm volatile ( "vmclear %1; setna %0"

ERROR:SPACING: space prohibited before that close parenthesis ')'
#396: FILE: drivers/kvm/kvm_main.c:362:
+		       : "=m"(error) : "m"(phys_addr) : "cc", "memory" );

WARNING:PREFER_PR_LEVEL: Prefer [subsystem eg: netdev]_err([subsystem]dev, ... then dev_err(dev, ... then pr_err(...  to printk(KERN_ERR ...
#398: FILE: drivers/kvm/kvm_main.c:364:
+		printk(KERN_ERR "kvm: vmclear fail: %p/%llx\n",

ERROR:SPACING: space prohibited after that open parenthesis '('
#438: FILE: drivers/kvm/kvm_main.c:404:
+		asm volatile ( "vmptrld %1; setna %0"

ERROR:SPACING: space prohibited before that close parenthesis ')'
#439: FILE: drivers/kvm/kvm_main.c:405:
+			       : "=m"(error) : "m"(phys_addr) : "cc" );

WARNING:PREFER_PR_LEVEL: Prefer [subsystem eg: netdev]_err([subsystem]dev, ... then dev_err(dev, ... then pr_err(...  to printk(KERN_ERR ...
#441: FILE: drivers/kvm/kvm_main.c:407:
+			printk(KERN_ERR "kvm: vmptrld %p/%llx fail\n",

CHECK:LINE_SPACING: Please don't use multiple blank lines
#485: FILE: drivers/kvm/kvm_main.c:451:
+
+

WARNING:LINE_SPACING: Missing a blank line after declarations
#514: FILE: drivers/kvm/kvm_main.c:480:
+	unsigned long ecx = cpuid_ecx(1);
+	return test_bit(5, &ecx); /* CPUID.1:ECX.VMX[bit 5] -> VT */

ERROR:SPACING: space prohibited after that open parenthesis '('
#564: FILE: drivers/kvm/kvm_main.c:530:
+	asm volatile ( "vmxon %0" : : "m"(phys_addr) : "memory", "cc" );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#564: FILE: drivers/kvm/kvm_main.c:530:
+	asm volatile ( "vmxon %0" : : "m"(phys_addr) : "memory", "cc" );

ERROR:SPACING: space prohibited after that open parenthesis '('
#569: FILE: drivers/kvm/kvm_main.c:535:
+	asm volatile ( "vmxoff" : : : "cc" );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#569: FILE: drivers/kvm/kvm_main.c:535:
+	asm volatile ( "vmxoff" : : : "cc" );

WARNING:TYPO_SPELLING: 'filp' may be misspelled - perhaps 'flip'?
#572: FILE: drivers/kvm/kvm_main.c:538:
+static int kvm_dev_open(struct inode *inode, struct file *filp)
                                                           ^^^^

Some words may have been misspelled.  Consider reviewing them.

CHECK:ALLOC_SIZEOF_STRUCT: Prefer kzalloc(sizeof(*kvm)...) over kzalloc(sizeof(struct kvm)...)
#574: FILE: drivers/kvm/kvm_main.c:540:
+	struct kvm *kvm = kzalloc(sizeof(struct kvm), GFP_KERNEL);

The allocation style is bad.  In general for family of
allocation functions using sizeof() to get memory size,
constructs like::

  p = alloc(sizeof(struct foo), ...)

should be::

  p = alloc(sizeof(*p), ...)

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#allocating-memory

WARNING:TYPO_SPELLING: 'filp' may be misspelled - perhaps 'flip'?
#647: FILE: drivers/kvm/kvm_main.c:613:
+static int kvm_dev_release(struct inode *inode, struct file *filp)
                                                              ^^^^

ERROR:SPACING: space prohibited after that open parenthesis '('
#661: FILE: drivers/kvm/kvm_main.c:627:
+	asm volatile ( "vmread %1, %0" : "=g"(value) : "r"(field) : "cc" );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#661: FILE: drivers/kvm/kvm_main.c:627:
+	asm volatile ( "vmread %1, %0" : "=g"(value) : "r"(field) : "cc" );

ERROR:SPACING: space prohibited after that open parenthesis '('
#669: FILE: drivers/kvm/kvm_main.c:635:
+	asm volatile ( "vmwrite %1, %2; setna %0"

ERROR:SPACING: space prohibited before that close parenthesis ')'
#670: FILE: drivers/kvm/kvm_main.c:636:
+		       : "=g"(error) : "r"(value), "r"(field) : "cc" );

WARNING:PREFER_PR_LEVEL: Prefer [subsystem eg: netdev]_err([subsystem]dev, ... then dev_err(dev, ... then pr_err(...  to printk(KERN_ERR ...
#672: FILE: drivers/kvm/kvm_main.c:638:
+		printk(KERN_ERR "vmwrite error: reg %lx value %lx (err %d)\n",

ERROR:SPACING: space prohibited after that open parenthesis '('
#687: FILE: drivers/kvm/kvm_main.c:653:
+	asm volatile ( "" );

ERROR:SPACING: space prohibited before that close parenthesis ')'
#687: FILE: drivers/kvm/kvm_main.c:653:
+	asm volatile ( "" );

CHECK:SPACING: spaces preferred around that '+' (ctx:VxV)
#688: FILE: drivers/kvm/kvm_main.c:654:
+	vmcs_writel(field+1, value >> 32);
 	                 ^

CHECK:LOGICAL_CONTINUATIONS: Logical continuations should be on the previous line
#720: FILE: drivers/kvm/kvm_main.c:686:
+		if (gfn >= memslot->base_gfn
+		    && gfn < memslot->base_gfn + memslot->npages)

CHECK:LOGICAL_CONTINUATIONS: Logical continuations should be on the previous line
#736: FILE: drivers/kvm/kvm_main.c:702:
+		if (gfn >= memslot->base_gfn
+		    && gfn < memslot->base_gfn + memslot->npages) {

CHECK:BRACES: Blank lines aren't necessary after an open brace '{'
#737: FILE: drivers/kvm/kvm_main.c:703:
+		    && gfn < memslot->base_gfn + memslot->npages) {
+

The placement of braces is stylistically incorrect.
The preferred way is to put the opening brace last on the line,
and put the closing brace first::

  if (x is true) {
          we do y
  }

This applies for all non-functional blocks.
However, there is one special case, namely functions: they have the
opening brace at the beginning of the next line, thus::

  int function(int x)
  {
          body of function
  }

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#placing-braces-and-spaces

WARNING:UNSPECIFIED_INT: Prefer 'unsigned int' to bare use of 'unsigned'
#755: FILE: drivers/kvm/kvm_main.c:721:
+	unsigned offset = (cr3 & (PAGE_SIZE-1)) >> 5;

CHECK:SPACING: spaces preferred around that '-' (ctx:VxV)
#755: FILE: drivers/kvm/kvm_main.c:721:
+	unsigned offset = (cr3 & (PAGE_SIZE-1)) >> 5;
 	                                   ^

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#783: FILE: drivers/kvm/kvm_main.c:749:
+		printk("set_cr0: 0x%lx #GP, reserved bits (0x%lx)\n", cr0, guest_cr0());

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr0', this function's name, in a string
#783: FILE: drivers/kvm/kvm_main.c:749:
+		printk("set_cr0: 0x%lx #GP, reserved bits (0x%lx)\n", cr0, guest_cr0());

Embedded function names are less appropriate to use as
refactoring can cause function renaming.  Prefer the use of
"%s", __func__ to embedded function names.

Note that this does not work with -f (--file) checkpatch option
as it depends on patch context providing the function name.

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#789: FILE: drivers/kvm/kvm_main.c:755:
+		printk("set_cr0: #GP, CD == 0 && NW == 1\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr0', this function's name, in a string
#789: FILE: drivers/kvm/kvm_main.c:755:
+		printk("set_cr0: #GP, CD == 0 && NW == 1\n");

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#795: FILE: drivers/kvm/kvm_main.c:761:
+		printk("set_cr0: #GP, set PG flag and a clear PE flag\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr0', this function's name, in a string
#795: FILE: drivers/kvm/kvm_main.c:761:
+		printk("set_cr0: #GP, set PG flag and a clear PE flag\n");

WARNING:LINE_SPACING: Missing a blank line after declarations
#814: FILE: drivers/kvm/kvm_main.c:780:
+			u32 guest_tr_ar;
+			if (!is_pae()) {

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#815: FILE: drivers/kvm/kvm_main.c:781:
+				printk("set_cr0: #GP, start paging in "

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr0', this function's name, in a string
#815: FILE: drivers/kvm/kvm_main.c:781:
+				printk("set_cr0: #GP, start paging in "

WARNING:SPLIT_STRING: quoted string split across lines
#816: FILE: drivers/kvm/kvm_main.c:782:
+				printk("set_cr0: #GP, start paging in "
+				       "long mode while PAE is disabled\n");

Quoted strings that appear as messages in userspace and can be
grepped, should not be split across multiple lines.

See: https://lore.kernel.org/lkml/20120203052727.GA15035@leaf/

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#822: FILE: drivers/kvm/kvm_main.c:788:
+				printk("set_cr0: #GP, start paging in "

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr0', this function's name, in a string
#822: FILE: drivers/kvm/kvm_main.c:788:
+				printk("set_cr0: #GP, start paging in "

WARNING:SPLIT_STRING: quoted string split across lines
#823: FILE: drivers/kvm/kvm_main.c:789:
+				printk("set_cr0: #GP, start paging in "
+				       "long mode while CS.L == 1\n");

CHECK:BRACES: Blank lines aren't necessary before a close brace '}'
#827: FILE: drivers/kvm/kvm_main.c:793:
+
+			}

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#830: FILE: drivers/kvm/kvm_main.c:796:
+				printk("%s: tss fixup for long mode. \n",

WARNING:QUOTED_WHITESPACE_BEFORE_NEWLINE: unnecessary whitespace before a quoted newline
#830: FILE: drivers/kvm/kvm_main.c:796:
+				printk("%s: tss fixup for long mode. \n",

WARNING:USE_FUNC: __func__ should be used instead of gcc specific __FUNCTION__
#831: FILE: drivers/kvm/kvm_main.c:797:
+				       __FUNCTION__);

WARNING:SUSPECT_CODE_INDENT: suspect code indent for conditional statements (16, 16)
#843: FILE: drivers/kvm/kvm_main.c:809:
+		} else
[...]
+		if (is_pae() &&

CHECK:BRACES: Unbalanced braces around else statement
#843: FILE: drivers/kvm/kvm_main.c:809:
+		} else

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#846: FILE: drivers/kvm/kvm_main.c:812:
+		if (is_pae() &&
+			    pdptrs_have_reserved_bits_set(vcpu, vcpu->cr3)) {

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#847: FILE: drivers/kvm/kvm_main.c:813:
+			printk("set_cr0: #GP, pdptrs reserved bits\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr0', this function's name, in a string
#847: FILE: drivers/kvm/kvm_main.c:813:
+			printk("set_cr0: #GP, pdptrs reserved bits\n");

CHECK:BRACES: Blank lines aren't necessary before a close brace '}'
#852: FILE: drivers/kvm/kvm_main.c:818:
+
+	}

WARNING:RETURN_VOID: void function return statements are not generally useful
#857: FILE: drivers/kvm/kvm_main.c:823:
+	return;
+}

CHECK:BRACES: braces {} should be used on all arms of this statement
#863: FILE: drivers/kvm/kvm_main.c:829:
+	if ((msw & CR0_PE_MASK) && !(cr0 & CR0_PE_MASK)) {
[...]
+	} else
[...]

CHECK:BRACES: Unbalanced braces around else statement
#867: FILE: drivers/kvm/kvm_main.c:833:
+	} else

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#868: FILE: drivers/kvm/kvm_main.c:834:
+		printk("lmsw: unexpected\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'lmsw', this function's name, in a string
#868: FILE: drivers/kvm/kvm_main.c:834:
+		printk("lmsw: unexpected\n");

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#881: FILE: drivers/kvm/kvm_main.c:847:
+		printk("set_cr4: #GP, reserved bits\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr4', this function's name, in a string
#881: FILE: drivers/kvm/kvm_main.c:847:
+		printk("set_cr4: #GP, reserved bits\n");

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#888: FILE: drivers/kvm/kvm_main.c:854:
+			printk("set_cr4: #GP, clearing PAE while in long mode\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr4', this function's name, in a string
#888: FILE: drivers/kvm/kvm_main.c:854:
+			printk("set_cr4: #GP, clearing PAE while in long mode\n");

CHECK:LOGICAL_CONTINUATIONS: Logical continuations should be on the previous line
#893: FILE: drivers/kvm/kvm_main.c:859:
+	} else if (is_paging() && !is_pae() && (cr4 & CR4_PAE_MASK)
+		   && pdptrs_have_reserved_bits_set(vcpu, vcpu->cr3)) {

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#894: FILE: drivers/kvm/kvm_main.c:860:
+		printk("set_cr4: #GP, pdptrs reserved bits\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr4', this function's name, in a string
#894: FILE: drivers/kvm/kvm_main.c:860:
+		printk("set_cr4: #GP, pdptrs reserved bits\n");

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#899: FILE: drivers/kvm/kvm_main.c:865:
+		printk("set_cr4: #GP, setting VMXE\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr4', this function's name, in a string
#899: FILE: drivers/kvm/kvm_main.c:865:
+		printk("set_cr4: #GP, setting VMXE\n");

ERROR:SPACING: space prohibited after that open parenthesis '('
#912: FILE: drivers/kvm/kvm_main.c:878:
+		if ( cr3 & CR3_L_MODE_RESEVED_BITS) {

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#913: FILE: drivers/kvm/kvm_main.c:879:
+			printk("set_cr3: #GP, reserved bits\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr3', this function's name, in a string
#913: FILE: drivers/kvm/kvm_main.c:879:
+			printk("set_cr3: #GP, reserved bits\n");

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#919: FILE: drivers/kvm/kvm_main.c:885:
+			printk("set_cr3: #GP, reserved bits\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr3', this function's name, in a string
#919: FILE: drivers/kvm/kvm_main.c:885:
+			printk("set_cr3: #GP, reserved bits\n");

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#925: FILE: drivers/kvm/kvm_main.c:891:
+			printk("set_cr3: #GP, pdptrs reserved bits\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr3', this function's name, in a string
#925: FILE: drivers/kvm/kvm_main.c:891:
+			printk("set_cr3: #GP, pdptrs reserved bits\n");

ERROR:SPACING: space prohibited after that open parenthesis '('
#941: FILE: drivers/kvm/kvm_main.c:907:
+	if ( cr8 & CR8_RESEVED_BITS) {

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#942: FILE: drivers/kvm/kvm_main.c:908:
+		printk("set_cr8: #GP, reserved bits 0x%lx\n", cr8);

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_cr8', this function's name, in a string
#942: FILE: drivers/kvm/kvm_main.c:908:
+		printk("set_cr8: #GP, reserved bits 0x%lx\n", cr8);

CHECK:LINE_SPACING: Please don't use multiple blank lines
#949: FILE: drivers/kvm/kvm_main.c:915:
+
+

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#977: FILE: drivers/kvm/kvm_main.c:943:
+		printk("set_efer: 0x%llx #GP, reserved bits\n", efer);

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_efer', this function's name, in a string
#977: FILE: drivers/kvm/kvm_main.c:943:
+		printk("set_efer: 0x%llx #GP, reserved bits\n", efer);

WARNING:PRINTK_WITHOUT_KERN_LEVEL: printk() should include KERN_<LEVEL> facility level
#983: FILE: drivers/kvm/kvm_main.c:949:
+		printk("set_efer: #GP, change LME while paging\n");

WARNING:EMBEDDED_FUNCTION_NAME: Prefer using '"%s...", __func__' to using 'set_efer', this function's name, in a string
#983: FILE: drivers/kvm/kvm_main.c:949:
+		printk("set_efer: #GP, change LME while paging\n");

WARNING:SUSPECT_CODE_INDENT: suspect code indent for conditional statements (8, 12)
#995: FILE: drivers/kvm/kvm_main.c:961:
+	if (!(efer & EFER_LMA))
+	    efer &= ~EFER_LME;

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1008: FILE: drivers/kvm/kvm_main.c:974:
+		vmcs_write32(VM_ENTRY_CONTROLS,
+				     vmcs_read32(VM_ENTRY_CONTROLS) |

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1014: FILE: drivers/kvm/kvm_main.c:980:
+		vmcs_write32(VM_ENTRY_CONTROLS,
+				     vmcs_read32(VM_ENTRY_CONTROLS) &

WARNING:USE_FUNC: __func__ should be used instead of gcc specific __FUNCTION__
#1034: FILE: drivers/kvm/kvm_main.c:1000:
+			    __FUNCTION__,

WARNING:USE_FUNC: __func__ should be used instead of gcc specific __FUNCTION__
#1043: FILE: drivers/kvm/kvm_main.c:1009:
+		vcpu_printf(vcpu, "%s: read guest err\n", __FUNCTION__);

CHECK:LINE_SPACING: Please don't use multiple blank lines
#1051: FILE: drivers/kvm/kvm_main.c:1017:
+
+

WARNING:USE_FUNC: __func__ should be used instead of gcc specific __FUNCTION__
#1055: FILE: drivers/kvm/kvm_main.c:1021:
+		vcpu_printf(vcpu, "%s: write guest err\n", __FUNCTION__);

ERROR:SPACING: space prohibited after that open parenthesis '('
#1060: FILE: drivers/kvm/kvm_main.c:1026:
+		    ~( X86_EFLAGS_IF | X86_EFLAGS_AC | X86_EFLAGS_TF));

WARNING:SPACING: space prohibited before semicolon
#1061: FILE: drivers/kvm/kvm_main.c:1027:
+	vmcs_write16(GUEST_CS_SELECTOR, ent[1]) ;

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1082: FILE: drivers/kvm/kvm_main.c:1048:
+	vmcs_write32(VM_ENTRY_INTR_INFO_FIELD,
+			irq | INTR_TYPE_EXT_INTR | INTR_INFO_VALID_MASK);

CHECK:LOGICAL_CONTINUATIONS: Logical continuations should be on the previous line
#1088: FILE: drivers/kvm/kvm_main.c:1054:
+	if ((vmcs_readl(GUEST_RFLAGS) & X86_EFLAGS_IF)
+	    && (vmcs_read32(GUEST_INTERRUPTIBILITY_INFO) & 3) == 0)

WARNING:TYPO_SPELLING: 'filp' may be misspelled - perhaps 'flip'?
#1116: FILE: drivers/kvm/kvm_main.c:1082:
+static long kvm_dev_ioctl(struct file *filp,
                                        ^^^^

WARNING:DEFAULT_NO_BREAK: switch default: should use break
#1123: FILE: drivers/kvm/kvm_main.c:1089:
+	default:
+		;

switch default case is sometimes written as "default:;".  This can
cause new cases added below default to be defective.

A "break;" should be added after empty default statement to avoid
unwanted fallthrough.

WARNING:CONST_STRUCT: struct vm_operations_struct should normally be const
#1151: FILE: drivers/kvm/kvm_main.c:1117:
+static struct vm_operations_struct kvm_dev_vm_ops = {

Using const is generally a good idea.  Checkpatch reads
a list of frequently used structs that are always or
almost always constant.

The existing structs list can be viewed from
`scripts/const_structs.checkpatch`.

See: https://lore.kernel.org/lkml/alpine.DEB.2.10.1608281509480.3321@hadrien/

WARNING:CONST_STRUCT: struct file_operations should normally be const
#1161: FILE: drivers/kvm/kvm_main.c:1127:
+static struct file_operations kvm_chardev_ops = {

ERROR:CODE_INDENT: code indent should use tabs where possible
#1177: FILE: drivers/kvm/kvm_main.c:1143:
+                       void *v)$

Code indent should use tabs instead of spaces.
Outside of comments, documentation and Kconfig,
spaces are never used for indentation.

See: https://www.kernel.org/doc/html/latest/process/coding-style.html#indentation

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1177: FILE: drivers/kvm/kvm_main.c:1143:
+static int kvm_reboot(struct notifier_block *notifier, unsigned long val,
+                       void *v)

WARNING:LEADING_SPACE: please, no spaces at the start of a line
#1177: FILE: drivers/kvm/kvm_main.c:1143:
+                       void *v)$

WARNING:PREFER_PR_LEVEL: Prefer [subsystem eg: netdev]_info([subsystem]dev, ... then dev_info(dev, ... then pr_info(...  to printk(KERN_INFO ...
#1184: FILE: drivers/kvm/kvm_main.c:1150:
+		printk(KERN_INFO "kvm: exiting vmx mode\n");

CHECK:PARENTHESIS_ALIGNMENT: Alignment should match open parenthesis
#1205: FILE: drivers/kvm/kvm_main.c:1171:
+	debugfs_invlpg = debugfs_create_u32("invlpg", 0444, debugfs_dir,
+					      &kvm_stat.invlpg);

WARNING:PREFER_PR_LEVEL: Prefer [subsystem eg: netdev]_err([subsystem]dev, ... then dev_err(dev, ... then pr_err(...  to printk(KERN_ERR ...
#1242: FILE: drivers/kvm/kvm_main.c:1208:
+		printk(KERN_ERR "kvm: no hardware support\n");

WARNING:PREFER_PR_LEVEL: Prefer [subsystem eg: netdev]_err([subsystem]dev, ... then dev_err(dev, ... then pr_err(...  to printk(KERN_ERR ...
#1246: FILE: drivers/kvm/kvm_main.c:1212:
+		printk(KERN_ERR "kvm: disabled by bios\n");

WARNING:PREFER_PR_LEVEL: Prefer [subsystem eg: netdev]_err([subsystem]dev, ... then dev_err(dev, ... then pr_err(...  to printk(KERN_ERR ...
#1261: FILE: drivers/kvm/kvm_main.c:1227:
+		printk (KERN_ERR "kvm: misc device register failed\n");

WARNING:SPACING: space prohibited between function name and open parenthesis '('
#1261: FILE: drivers/kvm/kvm_main.c:1227:
+		printk (KERN_ERR "kvm: misc device register failed\n");

CHECK:LINE_SPACING: Please don't use multiple blank lines
#1265: FILE: drivers/kvm/kvm_main.c:1231:
+
+

ERROR:ASSIGN_IN_IF: do not use assignment in if condition
#1266: FILE: drivers/kvm/kvm_main.c:1232:
+	if ((bad_page = alloc_page(GFP_KERNEL)) == NULL) {

Do not use assignments in if condition.
Example::

  if ((foo = bar(...)) < BAZ) {

should be written as::

  foo = bar(...);
  if (foo < BAZ) {

/tmp/tmp.gGZ8aIRHtl//home/kkleine/dev/lkml/0/patch.offset.25251.commit.dd8727e37b2aec544ed358181da7d8e923b8994c total: 48 errors, 83 warnings, 32 checks, 1260 lines checked

NOTE: For some of the reported defects, checkpatch may be able to
      mechanically convert to the typical style using --fix or --fix-inplace.

NOTE: Whitespace errors detected.
      You may wish to use scripts/cleanpatch or scripts/cleanfile

/tmp/tmp.gGZ8aIRHtl//home/kkleine/dev/lkml/0/patch.offset.25251.commit.dd8727e37b2aec544ed358181da7d8e923b8994c has style problems, please review.

NOTE: If any of the errors are false positives, please report
      them to the maintainer, see CHECKPATCH in MAINTAINERS.
